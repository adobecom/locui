!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e||self).wamWrapper=t()}(this,function(){const e="registerClient",t="clientMsg",n="sendCurrentDevice",s="clientMsg",r="clientStates",o="connect",i="error",a="connect_error",c="disconnect",l={ccdAppsState:{loading:"loading",loadingFailed:"loading_failed",loaded:"loaded",appRefreshedStarted:"appsRefreshStarted",cchDefault:"cchDefault"},appsPanelInstallAvailabilityStatus:"appsPanelInstallAvailabilityStatus",needConfirmation:"needConfirmation",closeConfirmation:"closeConfirmation",failed:"Failed",waiting:"Waiting",completed:"Completed",inprogress:"inProgress",appIncompatible:"AppIncompatible",appUnknown:"AppUnknown",cancelling:"Cancelling"},d="ui",u="engine",p="incompatibleWithCheckprevious",h="installed",f="updateAllConfirmation",m={fetchAppsListFromCCD:"getAppsAndServicesList",install:"install",update:"update",cancel:"cancel",retry:"retry",launch:"launch",startTrial:"startTrial",updateAll:"updateAll",uninstall:"uninstall",installModule:"installModule",cancelModule:"cancelModule",retryModule:"retryModule",uninstallModule:"uninstallModule"},g=18e4,y="http",C="http_ping",v="http_initiate_workflow",b="https",k="v1",w="v2",A={clientIdToAppName:{CCHomeWeb1:"CCHome",CCXWeb1:"AssetsWeb",ccweb_webapp:"Canvas",ccweb_webapp_preview:"Canvas",PSWebApp1:"PhotoshopWeb",SunbreakWebUI1:"AccountManagement"},status:{success:"Success",failure:"Failure"},ccdStates:{ccdNotPresent:"ccd-not-present",signedIn:"signed-in",signedOut:"signed-out/self-update",userMismatch:"usermismatch"},browserIncompatibleForV2:"browser-incompatible",ccdIncompatibleForV2:"ccd-incompatible",wf:{v2:"V2",v1:"V1"}},D="v2ToV1",T="v1ToV2",S="onGetCurrentDevice",x="onCCDDetectionByClient",I="onClientRecvCCDAppsState",P="onReceiveCurrentDevice",E="onClientRegistratonWithWAM",B="onClientWAMConnection",F="onCommandProgress",M="onAppUnknown",L="onSuccessfulWamConnection",N="onConnectionFailureInConnectedClient",R="client-wam-registration-time-taken",O={local:"https://localhost.adobe.com:3000",dev:"https://stage.wam.adobe.com",qe:"https://stage.wam.adobe.com",stage:"https://stage.wam.adobe.com",prod:"https://prod.wam.adobe.com"},W={stage:"https://cc-api-data-stage.adobe.io/ingest/",prod:"https://cc-api-data.adobe.io/ingest/"},_="cchome-web-service",U={local:"https://sqe-prstg-ffc.oobesaas.adobe.com",dev:"https://sqe-prstg-ffc.oobesaas.adobe.com",qe:"https://sqe-prstg-ffc.oobesaas.adobe.com",stage:"https://sqe-prstg-ffc.oobesaas.adobe.com",prod:"https://prod-rel-ffc-ccm.oobesaas.adobe.com"},q={local:"https://cdn-stg-ffc.oobesaas.adobe.com",dev:"https://cdn-stg-ffc.oobesaas.adobe.com",qe:"https://cdn-stg-ffc.oobesaas.adobe.com",stage:"https://cdn-stg-ffc.oobesaas.adobe.com",prod:"https://cdn-ffc.oobesaas.adobe.com"};function $(e){var t={exports:{}};return e(t,t.exports),t.exports}var H=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,j=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],V=function(e){var t,n,s=e,r=e.indexOf("["),o=e.indexOf("]");-1!=r&&-1!=o&&(e=e.substring(0,r)+e.substring(r,o).replace(/:/g,";")+e.substring(o,e.length));for(var i,a=H.exec(e||""),c={},l=14;l--;)c[j[l]]=a[l]||"";return-1!=r&&-1!=o&&(c.source=s,c.host=c.host.substring(1,c.host.length-1).replace(/;/g,":"),c.authority=c.authority.replace("[","").replace("]","").replace(/;/g,":"),c.ipv6uri=!0),c.pathNames=(n=(t=c.path).replace(/\/{2,9}/g,"/").split("/"),"/"!=t.substr(0,1)&&0!==t.length||n.splice(0,1),"/"==t.substr(t.length-1,1)&&n.splice(n.length-1,1),n),c.queryKey=(i={},c.query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,n){t&&(i[t]=n)}),i),c},z=1e3,X=60*z,J=60*X,G=24*J,Y=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"days":case"day":case"d":return n*G;case"hours":case"hour":case"hrs":case"hr":case"h":return n*J;case"minutes":case"minute":case"mins":case"min":case"m":return n*X;case"seconds":case"second":case"secs":case"sec":case"s":return n*z;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}(e);if("number"===n&&!1===isNaN(e))return t.long?function(e){return K(e,G,"day")||K(e,J,"hour")||K(e,X,"minute")||K(e,z,"second")||e+" ms"}(e):function(e){return e>=G?Math.round(e/G)+"d":e>=J?Math.round(e/J)+"h":e>=X?Math.round(e/X)+"m":e>=z?Math.round(e/z)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function K(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var Z=$(function(e,t){function n(e){var n;function r(){if(r.enabled){var e=r,s=+new Date,o=s-(n||s);e.diff=o,e.prev=n,e.curr=s,n=s;for(var i=new Array(arguments.length),a=0;a<i.length;a++)i[a]=arguments[a];i[0]=t.coerce(i[0]),"string"!=typeof i[0]&&i.unshift("%O");var c=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,function(n,s){if("%%"===n)return n;c++;var r=t.formatters[s];return"function"==typeof r&&(n=r.call(e,i[c]),i.splice(c,1),c--),n}),t.formatArgs.call(e,i);var l=r.log||t.log||console.log.bind(console);l.apply(e,i)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var n,s=0;for(n in e)s=(s<<5)-s+e.charCodeAt(n),s|=0;return t.colors[Math.abs(s)%t.colors.length]}(e),r.destroy=s,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function s(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var s=("string"==typeof e?e:"").split(/[\s,]+/),r=s.length;for(n=0;n<r;n++)s[n]&&("-"===(e=s[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var o=t.instances[n];o.enabled=t.enabled(o.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,s;for(n=0,s=t.skips.length;n<s;n++)if(t.skips[n].test(e))return!1;for(n=0,s=t.names.length;n<s;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=Y,t.instances=[],t.names=[],t.skips=[],t.formatters={}}),Q=$(function(e,t){function n(){var e;try{e=t.storage.debug}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}(t=e.exports=Z).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){var s="color: "+this.color;e.splice(1,0,s,"color: inherit");var r=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(r++,"%c"===e&&(o=r))}),e.splice(o,0,s)}},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=n,t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(n())}),ee=Q("socket.io-client:url"),te=$(function(e){function t(e){if(e)return function(e){for(var n in t.prototype)e[n]=t.prototype[n];return e}(e)}e.exports=t,t.prototype.on=t.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},t.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,s=this._callbacks["$"+e];if(!s)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r=0;r<s.length;r++)if((n=s[r])===t||n.fn===t){s.splice(r,1);break}return 0===s.length&&delete this._callbacks["$"+e],this},t.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],s=1;s<arguments.length;s++)t[s-1]=arguments[s];if(n){s=0;for(var r=(n=n.slice(0)).length;s<r;++s)n[s].apply(this,t)}return this},t.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},t.prototype.hasListeners=function(e){return!!this.listeners(e).length}}),ne={}.toString,se=Array.isArray||function(e){return"[object Array]"==ne.call(e)},re=function(e){return oe&&Buffer.isBuffer(e)||ie&&(e instanceof ArrayBuffer||function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}(e))},oe="function"==typeof Buffer&&"function"==typeof Buffer.isBuffer,ie="function"==typeof ArrayBuffer,ae=Object.prototype.toString,ce="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===ae.call(Blob),le="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===ae.call(File);function de(e,t){if(!e)return e;if(re(e)){var n={_placeholder:!0,num:t.length};return t.push(e),n}if(se(e)){for(var s=new Array(e.length),r=0;r<e.length;r++)s[r]=de(e[r],t);return s}if("object"==typeof e&&!(e instanceof Date)){for(var o in s={},e)s[o]=de(e[o],t);return s}return e}function ue(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(se(e))for(var n=0;n<e.length;n++)e[n]=ue(e[n],t);else if("object"==typeof e)for(var s in e)e[s]=ue(e[s],t);return e}var pe=function(e){var t=[],n=e;return n.data=de(e.data,t),n.attachments=t.length,{packet:n,buffers:t}},he=function(e,t){return e.data=ue(e.data,t),e.attachments=void 0,e},fe=$(function(e,t){var n=Q("socket.io-parser");function s(){}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=s,t.Decoder=i;var r=t.ERROR+'"encode error"';function o(e){var s=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(s+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(s+=e.nsp+","),null!=e.id&&(s+=e.id),null!=e.data){var o=function(e){try{return JSON.stringify(e)}catch(e){return!1}}(e.data);if(!1===o)return r;s+=o}return n("encoded %j as %s",e,s),s}function i(){this.reconstructor=null}function a(e){this.reconPack=e,this.buffers=[]}function c(e){return{type:t.ERROR,data:"parser error: "+e}}s.prototype.encode=function(e,s){n("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type?function(e,t){!function(e,t){var n=0,s=e;!function e(r,o,i){if(!r)return r;if(ce&&r instanceof Blob||le&&r instanceof File){n++;var a=new FileReader;a.onload=function(){i?i[o]=this.result:s=this.result,--n||t(s)},a.readAsArrayBuffer(r)}else if(se(r))for(var c=0;c<r.length;c++)e(r[c],c,r);else if("object"==typeof r&&!re(r))for(var l in r)e(r[l],l,r)}(s),n||t(s)}(e,function(e){var n=pe(e),s=o(n.packet),r=n.buffers;r.unshift(s),t(r)})}(e,s):s([o(e)])},te(i.prototype),i.prototype.add=function(e){var s;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");s=function(e){var s=0,r={type:Number(e.charAt(0))};if(null==t.types[r.type])return c("unknown packet type "+r.type);if(t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type){for(var o=s+1;"-"!==e.charAt(++s)&&s!=e.length;);var i=e.substring(o,s);if(i!=Number(i)||"-"!==e.charAt(s))throw new Error("Illegal attachments");r.attachments=Number(i)}if("/"===e.charAt(s+1)){for(o=s+1;++s&&","!==(l=e.charAt(s))&&s!==e.length;);r.nsp=e.substring(o,s)}else r.nsp="/";var a=e.charAt(s+1);if(""!==a&&Number(a)==a){for(o=s+1;++s;){var l;if(null==(l=e.charAt(s))||Number(l)!=l){--s;break}if(s===e.length)break}r.id=Number(e.substring(o,s+1))}if(e.charAt(++s)){var d=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(s));if(!1===d||r.type!==t.ERROR&&!se(d))return c("invalid payload");r.data=d}return n("decoded %s as %j",e,r),r}(e),t.BINARY_EVENT===s.type||t.BINARY_ACK===s.type?(this.reconstructor=new a(s),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",s)):this.emit("decoded",s)}else{if(!re(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(s=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",s))}},i.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},a.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=he(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},a.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}}),me=$(function(e){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}}),ge="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")(),ye=function(e){var t=e.xdomain,n=e.xscheme,s=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||me))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!n&&s)return new XDomainRequest}catch(e){}if(!t)try{return new(ge[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}},Ce=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var s in e)n.call(e,s)&&t.push(s);return t},ve=Object.prototype.toString,be="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===ve.call(Blob),ke="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===ve.call(File),we=function e(t){if(!t||"object"!=typeof t)return!1;if(se(t)){for(var n=0,s=t.length;n<s;n++)if(e(t[n]))return!0;return!1}if("function"==typeof Buffer&&Buffer.isBuffer&&Buffer.isBuffer(t)||"function"==typeof ArrayBuffer&&t instanceof ArrayBuffer||be&&t instanceof Blob||ke&&t instanceof File)return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&e(t[r]))return!0;return!1},Ae=function(e,t,n){var s=e.byteLength;if(t=t||0,n=n||s,e.slice)return e.slice(t,n);if(t<0&&(t+=s),n<0&&(n+=s),n>s&&(n=s),t>=s||t>=n||0===s)return new ArrayBuffer(0);for(var r=new Uint8Array(e),o=new Uint8Array(n-t),i=t,a=0;i<n;i++,a++)o[a]=r[i];return o.buffer};function De(){}var Te,Se,xe,Ie=String.fromCharCode;function Pe(e){for(var t,n,s=[],r=0,o=e.length;r<o;)(t=e.charCodeAt(r++))>=55296&&t<=56319&&r<o?56320==(64512&(n=e.charCodeAt(r++)))?s.push(((1023&t)<<10)+(1023&n)+65536):(s.push(t),r--):s.push(t);return s}function Ee(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function Be(e,t){return Ie(e>>t&63|128)}function Fe(e,t){if(0==(4294967168&e))return Ie(e);var n="";return 0==(4294965248&e)?n=Ie(e>>6&31|192):0==(4294901760&e)?(Ee(e,t)||(e=65533),n=Ie(e>>12&15|224),n+=Be(e,6)):0==(4292870144&e)&&(n=Ie(e>>18&7|240),n+=Be(e,12),n+=Be(e,6)),n+Ie(63&e|128)}function Me(){if(xe>=Se)throw Error("Invalid byte index");var e=255&Te[xe];if(xe++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function Le(e){var t,n;if(xe>Se)throw Error("Invalid byte index");if(xe==Se)return!1;if(t=255&Te[xe],xe++,0==(128&t))return t;if(192==(224&t)){if((n=(31&t)<<6|Me())>=128)return n;throw Error("Invalid continuation byte")}if(224==(240&t)){if((n=(15&t)<<12|Me()<<6|Me())>=2048)return Ee(n,e)?n:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(n=(7&t)<<18|Me()<<12|Me()<<6|Me())>=65536&&n<=1114111)return n;throw Error("Invalid UTF-8 detected")}var Ne=$(function(e,t){var n;n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t.encode=function(e){var t,s=new Uint8Array(e),r=s.length,o="";for(t=0;t<r;t+=3)o+=n[s[t]>>2],o+=n[(3&s[t])<<4|s[t+1]>>4],o+=n[(15&s[t+1])<<2|s[t+2]>>6],o+=n[63&s[t+2]];return r%3==2?o=o.substring(0,o.length-1)+"=":r%3==1&&(o=o.substring(0,o.length-2)+"=="),o},t.decode=function(e){var t,s,r,o,i,a=.75*e.length,c=e.length,l=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var d=new ArrayBuffer(a),u=new Uint8Array(d);for(t=0;t<c;t+=4)s=n.indexOf(e[t]),r=n.indexOf(e[t+1]),o=n.indexOf(e[t+2]),i=n.indexOf(e[t+3]),u[l++]=s<<2|r>>4,u[l++]=(15&r)<<4|o>>2,u[l++]=(3&o)<<6|63&i;return d}}),Re=void 0!==Re?Re:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,Oe=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),We=Oe&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),_e=Re&&Re.prototype.append&&Re.prototype.getBlob;function Ue(e){return e.map(function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var n=new Uint8Array(e.byteLength);n.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=n.buffer}return t}return e})}function qe(e,t){t=t||{};var n=new Re;return Ue(e).forEach(function(e){n.append(e)}),t.type?n.getBlob(t.type):n.getBlob()}function $e(e,t){return new Blob(Ue(e),t||{})}"undefined"!=typeof Blob&&(qe.prototype=Blob.prototype,$e.prototype=Blob.prototype);var He=Oe?We?Blob:$e:_e?qe:void 0,je=$(function(e,t){var n;"undefined"!=typeof ArrayBuffer&&(n=Ne);var s="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),r="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),o=s||r;t.protocol=3;var i=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},a=Ce(i),c={type:"error",data:"parser error"};function l(e,t,n){for(var s=new Array(e.length),r=function(e,t,n){var s=!1;return n=n||De,r.count=e,0===e?t():r;function r(e,o){if(r.count<=0)throw new Error("after called too many times");--r.count,e?(s=!0,t(e),t=n):0!==r.count||s||t(null,o)}}(e.length,n),o=function(e,n,r){t(n,function(t,n){s[e]=n,r(t,s)})},i=0;i<e.length;i++)o(i,e[i],r)}t.encodePacket=function(e,n,s,r){"function"==typeof n&&(r=n,n=!1),"function"==typeof s&&(r=s,s=null);var a=void 0===e.data?void 0:e.data.buffer||e.data;if("undefined"!=typeof ArrayBuffer&&a instanceof ArrayBuffer)return function(e,n,s){if(!n)return t.encodeBase64Packet(e,s);var r=e.data,o=new Uint8Array(r),a=new Uint8Array(1+r.byteLength);a[0]=i[e.type];for(var c=0;c<o.length;c++)a[c+1]=o[c];return s(a.buffer)}(e,n,r);if(void 0!==He&&a instanceof He)return function(e,n,s){if(!n)return t.encodeBase64Packet(e,s);if(o)return function(e,n,s){if(!n)return t.encodeBase64Packet(e,s);var r=new FileReader;return r.onload=function(){t.encodePacket({type:e.type,data:r.result},n,!0,s)},r.readAsArrayBuffer(e.data)}(e,n,s);var r=new Uint8Array(1);return r[0]=i[e.type],s(new He([r.buffer,e.data]))}(e,n,r);if(a&&a.base64)return function(e,n){return n("b"+t.packets[e.type]+e.data.data)}(e,r);var c=i[e.type];return void 0!==e.data&&(c+=s?function(e,t){for(var n=!1!==(t=t||{}).strict,s=Pe(e),r=s.length,o=-1,i="";++o<r;)i+=Fe(s[o],n);return i}(String(e.data),{strict:!1}):String(e.data)),r(""+c)},t.encodeBase64Packet=function(e,n){var s,r="b"+t.packets[e.type];if(void 0!==He&&e.data instanceof He){var o=new FileReader;return o.onload=function(){var e=o.result.split(",")[1];n(r+e)},o.readAsDataURL(e.data)}try{s=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var i=new Uint8Array(e.data),a=new Array(i.length),c=0;c<i.length;c++)a[c]=i[c];s=String.fromCharCode.apply(null,a)}return r+=btoa(s),n(r)},t.decodePacket=function(e,n,s){if(void 0===e)return c;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),n);if(s&&!1===(e=function(e){try{e=function(e,t){var n=!1!==(t=t||{}).strict;Te=Pe(e),Se=Te.length,xe=0;for(var s,r=[];!1!==(s=Le(n));)r.push(s);return function(e){for(var t,n=e.length,s=-1,r="";++s<n;)(t=e[s])>65535&&(r+=Ie((t-=65536)>>>10&1023|55296),t=56320|1023&t),r+=Ie(t);return r}(r)}(e,{strict:!1})}catch(e){return!1}return e}(e)))return c;var r=e.charAt(0);return Number(r)==r&&a[r]?e.length>1?{type:a[r],data:e.substring(1)}:{type:a[r]}:c}r=new Uint8Array(e)[0];var o=Ae(e,1);return He&&"blob"===n&&(o=new He([o])),{type:a[r],data:o}},t.decodeBase64Packet=function(e,t){var s=a[e.charAt(0)];if(!n)return{type:s,data:{base64:!0,data:e.substr(1)}};var r=n.decode(e.substr(1));return"blob"===t&&He&&(r=new He([r])),{type:s,data:r}},t.encodePayload=function(e,n,s){"function"==typeof n&&(s=n,n=null);var r=we(e);return n&&r?He&&!o?t.encodePayloadAsBlob(e,s):t.encodePayloadAsArrayBuffer(e,s):e.length?void l(e,function(e,s){t.encodePacket(e,!!r&&n,!1,function(e){s(null,function(e){return e.length+":"+e}(e))})},function(e,t){return s(t.join(""))}):s("0:")},t.decodePayload=function(e,n,s){if("string"!=typeof e)return t.decodePayloadAsBinary(e,n,s);var r;if("function"==typeof n&&(s=n,n=null),""===e)return s(c,0,1);for(var o,i,a="",l=0,d=e.length;l<d;l++){var u=e.charAt(l);if(":"===u){if(""===a||a!=(o=Number(a)))return s(c,0,1);if(a!=(i=e.substr(l+1,o)).length)return s(c,0,1);if(i.length){if(r=t.decodePacket(i,n,!1),c.type===r.type&&c.data===r.data)return s(c,0,1);if(!1===s(r,l+o,d))return}l+=o,a=""}else a+=u}return""!==a?s(c,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,n){if(!e.length)return n(new ArrayBuffer(0));l(e,function(e,n){t.encodePacket(e,!0,!0,function(e){return n(null,e)})},function(e,t){var s=t.reduce(function(e,t){var n;return e+(n="string"==typeof t?t.length:t.byteLength).toString().length+n+2},0),r=new Uint8Array(s),o=0;return t.forEach(function(e){var t="string"==typeof e,n=e;if(t){for(var s=new Uint8Array(e.length),i=0;i<e.length;i++)s[i]=e.charCodeAt(i);n=s.buffer}r[o++]=t?0:1;var a=n.byteLength.toString();for(i=0;i<a.length;i++)r[o++]=parseInt(a[i]);for(r[o++]=255,s=new Uint8Array(n),i=0;i<s.length;i++)r[o++]=s[i]}),n(r.buffer)})},t.encodePayloadAsBlob=function(e,n){l(e,function(e,n){t.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var s=new Uint8Array(e.length),r=0;r<e.length;r++)s[r]=e.charCodeAt(r);e=s.buffer,t[0]=0}var o=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),i=new Uint8Array(o.length+1);for(r=0;r<o.length;r++)i[r]=parseInt(o[r]);if(i[o.length]=255,He){var a=new He([t.buffer,i.buffer,e]);n(null,a)}})},function(e,t){return n(new He(t))})},t.decodePayloadAsBinary=function(e,n,s){"function"==typeof n&&(s=n,n=null);for(var r=e,o=[];r.byteLength>0;){for(var i=new Uint8Array(r),a=0===i[0],l="",d=1;255!==i[d];d++){if(l.length>310)return s(c,0,1);l+=i[d]}r=Ae(r,2+l.length),l=parseInt(l);var u=Ae(r,0,l);if(a)try{u=String.fromCharCode.apply(null,new Uint8Array(u))}catch(e){var p=new Uint8Array(u);for(u="",d=0;d<p.length;d++)u+=String.fromCharCode(p[d])}o.push(u),r=Ae(r,l)}var h=o.length;o.forEach(function(e,r){s(t.decodePacket(e,n,!0),r,h)})}}),Ve=ze;function ze(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}te(ze.prototype),ze.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},ze.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},ze.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},ze.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},ze.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},ze.prototype.onData=function(e){var t=je.decodePacket(e,this.socket.binaryType);this.onPacket(t)},ze.prototype.onPacket=function(e){this.emit("packet",e)},ze.prototype.onClose=function(){this.readyState="closed",this.emit("close")};var Xe,Je=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},Ge=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},Ye="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Ke={},Ze=0,Qe=0;function et(e){var t="";do{t=Ye[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function tt(){var e=et(+new Date);return e!==Xe?(Ze=0,Xe=e):e+"."+et(Ze++)}for(;Qe<64;Qe++)Ke[Ye[Qe]]=Qe;tt.encode=et,tt.decode=function(e){var t=0;for(Qe=0;Qe<e.length;Qe++)t=64*t+Ke[e.charAt(Qe)];return t};var nt=tt,st=Q("engine.io-client:polling"),rt=it,ot=null!=new ye({xdomain:!1}).responseType;function it(e){ot&&!(e&&e.forceBase64)||(this.supportsBinary=!1),Ve.call(this,e)}Ge(it,Ve),it.prototype.name="polling",it.prototype.doOpen=function(){this.poll()},it.prototype.pause=function(e){var t=this;function n(){st("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var s=0;this.polling&&(st("we are currently polling - waiting to pause"),s++,this.once("pollComplete",function(){st("pre-pause polling complete"),--s||n()})),this.writable||(st("we are currently writing - waiting to pause"),s++,this.once("drain",function(){st("pre-pause writing complete"),--s||n()}))}else n()},it.prototype.poll=function(){st("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},it.prototype.onData=function(e){var t=this;st("polling got data %s",e),je.decodePayload(e,this.socket.binaryType,function(e,n,s){if("opening"===t.readyState&&"open"===e.type&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():st('ignoring poll - transport state "%s"',this.readyState))},it.prototype.doClose=function(){var e=this;function t(){st("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(st("transport open - closing"),t()):(st("transport not open - deferring close"),this.once("open",t))},it.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};je.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,n)})},it.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=nt()),this.supportsBinary||e.sid||(e.b64=1),e=Je(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e};var at=Q("engine.io-client:polling-xhr"),ct=ut,lt=pt;function dt(){}function ut(e){if(rt.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,"undefined"!=typeof location){var t="https:"===location.protocol,n=location.port;n||(n=t?443:80),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port,this.xs=e.secure!==t}}function pt(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function ht(){for(var e in pt.requests)pt.requests.hasOwnProperty(e)&&pt.requests[e].abort()}Ge(ut,rt),ut.prototype.supportsBinary=!0,ut.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.withCredentials=this.withCredentials,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new pt(e)},ut.prototype.doWrite=function(e,t){var n=this.request({method:"POST",data:e,isBinary:"string"!=typeof e&&void 0!==e}),s=this;n.on("success",t),n.on("error",function(e){s.onError("xhr post error",e)}),this.sendXhr=n},ut.prototype.doPoll=function(){at("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},te(pt.prototype),pt.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new ye(e),n=this;try{at("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var s in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(s)&&t.setRequestHeader(s,this.extraHeaders[s])}catch(e){}if("POST"===this.method)try{t.setRequestHeader("Content-type",this.isBinary?"application/octet-stream":"text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.withCredentials),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){n.onLoad()},t.onerror=function(){n.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");(n.supportsBinary&&"application/octet-stream"===e||"application/octet-stream; charset=UTF-8"===e)&&(t.responseType="arraybuffer")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?n.onLoad():setTimeout(function(){n.onError("number"==typeof t.status?t.status:0)},0))},at("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout(function(){n.onError(e)},0)}"undefined"!=typeof document&&(this.index=pt.requestsCount++,pt.requests[this.index]=this)},pt.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},pt.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},pt.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},pt.prototype.cleanup=function(e){if(null!=this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=dt:this.xhr.onreadystatechange=dt,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete pt.requests[this.index],this.xhr=null}},pt.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e=("application/octet-stream"===t||"application/octet-stream; charset=UTF-8"===t)&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},pt.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},pt.prototype.abort=function(){this.cleanup()},pt.requestsCount=0,pt.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",ht):"function"==typeof addEventListener&&addEventListener("onpagehide"in ge?"pagehide":"unload",ht,!1)),ct.Request=lt;var ft,mt=vt,gt=/\n/g,yt=/\\n/g;function Ct(){}function vt(e){rt.call(this,e),this.query=this.query||{},ft||(ft=ge.___eio=ge.___eio||[]),this.index=ft.length;var t=this;ft.push(function(e){t.onData(e)}),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",function(){t.script&&(t.script.onerror=Ct)},!1)}Ge(vt,rt),vt.prototype.supportsBinary=!1,vt.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),rt.prototype.doClose.call(this)},vt.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},vt.prototype.doWrite=function(e,t){var n=this;if(!this.form){var s,r=document.createElement("form"),o=document.createElement("textarea"),i=this.iframeId="eio_iframe_"+this.index;r.className="socketio",r.style.position="absolute",r.style.top="-1000px",r.style.left="-1000px",r.target=i,r.method="POST",r.setAttribute("accept-charset","utf-8"),o.name="d",r.appendChild(o),document.body.appendChild(r),this.form=r,this.area=o}function a(){c(),t()}function c(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(e){n.onError("jsonp polling iframe removal error",e)}try{s=document.createElement('<iframe src="javascript:0" name="'+n.iframeId+'">')}catch(e){(s=document.createElement("iframe")).name=n.iframeId,s.src="javascript:0"}s.id=n.iframeId,n.form.appendChild(s),n.iframe=s}this.form.action=this.uri(),c(),e=e.replace(yt,"\\\n"),this.area.value=e.replace(gt,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&a()}:this.iframe.onload=a};var bt,kt,wt=Q("engine.io-client:websocket");if("undefined"!=typeof WebSocket?bt=WebSocket:"undefined"!=typeof self&&(bt=self.WebSocket||self.MozWebSocket),"undefined"==typeof window)try{kt={__proto__:null,default:{}}}catch(e){}var At=bt||kt,Dt=Tt;function Tt(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=bt&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(At=kt),Ve.call(this,e)}Ge(Tt,Ve),Tt.prototype.name="websocket",Tt.prototype.supportsBinary=!0,Tt.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,n={};this.isReactNative||(n.agent=this.agent,n.perMessageDeflate=this.perMessageDeflate,n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized),this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?t?new At(e,t):new At(e):new At(e,t,n)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},Tt.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},Tt.prototype.write=function(e){var t=this;this.writable=!1;for(var n=e.length,s=0,r=n;s<r;s++)!function(e){je.encodePacket(e,t.supportsBinary,function(s){if(!t.usingBrowserWebSocket){var r={};e.options&&(r.compress=e.options.compress),t.perMessageDeflate&&("string"==typeof s?Buffer.byteLength(s):s.length)<t.perMessageDeflate.threshold&&(r.compress=!1)}try{t.usingBrowserWebSocket?t.ws.send(s):t.ws.send(s,r)}catch(e){wt("websocket closed before onclose event")}--n||(t.emit("flush"),setTimeout(function(){t.writable=!0,t.emit("drain")},0))})}(e[s])},Tt.prototype.onClose=function(){Ve.prototype.onClose.call(this)},Tt.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},Tt.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=nt()),this.supportsBinary||(e.b64=1),(e=Je(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},Tt.prototype.check=function(){return!(!At||"__initialize"in At&&this.name===Tt.prototype.name)};var St={polling:function(e){var t=!1,n=!1,s=!1!==e.jsonp;if("undefined"!=typeof location){var r="https:"===location.protocol,o=location.port;o||(o=r?443:80),t=e.hostname!==location.hostname||o!==e.port,n=e.secure!==r}if(e.xdomain=t,e.xscheme=n,"open"in new ye(e)&&!e.forceJSONP)return new ct(e);if(!s)throw new Error("JSONP disabled");return new mt(e)},websocket:Dt},xt=[].indexOf,It=function(e,t){if(xt)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1},Pt=Q("engine.io-client:socket"),Et=Bt;function Bt(e,t){if(!(this instanceof Bt))return new Bt(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=V(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=V(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=function(e){for(var t={},n=e.split("&"),s=0,r=n.length;s<r;s++){var o=n[s].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.withCredentials=!1!==t.withCredentials,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||void 0,this.key=t.key||void 0,this.passphrase=t.passphrase||void 0,this.cert=t.cert||void 0,this.ca=t.ca||void 0,this.ciphers=t.ciphers||void 0,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}Bt.priorWebsocketSuccess=!1,te(Bt.prototype),Bt.protocol=je.protocol,Bt.Socket=Bt,Bt.Transport=Ve,Bt.transports=St,Bt.parser=je,Bt.prototype.createTransport=function(e){Pt('creating transport "%s"',e);var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.query);t.EIO=je.protocol,t.transport=e;var n=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new St[e]({query:t,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,withCredentials:n.withCredentials||this.withCredentials,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative})},Bt.prototype.open=function(){var e;if(this.rememberUpgrade&&Bt.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},Bt.prototype.setTransport=function(e){Pt("setting transport %s",e.name);var t=this;this.transport&&(Pt("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},Bt.prototype.probe=function(e){Pt('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),n=!1,s=this;function r(){s.onlyBinaryUpgrades&&(n=n||!this.supportsBinary&&s.transport.supportsBinary),n||(Pt('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(r){if(!n)if("pong"===r.type&&"probe"===r.data){if(Pt('probe transport "%s" pong',e),s.upgrading=!0,s.emit("upgrading",t),!t)return;Bt.priorWebsocketSuccess="websocket"===t.name,Pt('pausing current transport "%s"',s.transport.name),s.transport.pause(function(){n||"closed"!==s.readyState&&(Pt("changing transport and sending upgrade packet"),d(),s.setTransport(t),t.send([{type:"upgrade"}]),s.emit("upgrade",t),t=null,s.upgrading=!1,s.flush())})}else{Pt('probe transport "%s" failed',e);var o=new Error("probe error");o.transport=t.name,s.emit("upgradeError",o)}}))}function o(){n||(n=!0,d(),t.close(),t=null)}function i(n){var r=new Error("probe error: "+n);r.transport=t.name,o(),Pt('probe transport "%s" failed because of error: %s',e,n),s.emit("upgradeError",r)}function a(){i("transport closed")}function c(){i("socket closed")}function l(e){t&&e.name!==t.name&&(Pt('"%s" works - aborting "%s"',e.name,t.name),o())}function d(){t.removeListener("open",r),t.removeListener("error",i),t.removeListener("close",a),s.removeListener("close",c),s.removeListener("upgrading",l)}Bt.priorWebsocketSuccess=!1,t.once("open",r),t.once("error",i),t.once("close",a),this.once("close",c),this.once("upgrading",l),t.open()},Bt.prototype.onOpen=function(){if(Pt("socket open"),this.readyState="open",Bt.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){Pt("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},Bt.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(Pt('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else Pt('packet received with socket readyState "%s"',this.readyState)},Bt.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},Bt.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},Bt.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){Pt("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},Bt.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},Bt.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},Bt.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(Pt("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},Bt.prototype.write=Bt.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},Bt.prototype.sendPacket=function(e,t,n,s){if("function"==typeof t&&(s=t,t=void 0),"function"==typeof n&&(s=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var r={type:e,data:t,options:n};this.emit("packetCreate",r),this.writeBuffer.push(r),s&&this.once("flush",s),this.flush()}},Bt.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?s():t()}):this.upgrading?s():t()}function t(){e.onClose("forced close"),Pt("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function s(){e.once("upgrade",n),e.once("upgradeError",n)}return this},Bt.prototype.onError=function(e){Pt("socket error %j",e),Bt.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},Bt.prototype.onClose=function(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(Pt('socket close with reason: "%s"',e),clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)},Bt.prototype.filterUpgrades=function(e){for(var t=[],n=0,s=e.length;n<s;n++)~It(this.transports,e[n])&&t.push(e[n]);return t};var Ft=Et;Ft.parser=je;var Mt=function(e,t){for(var n=[],s=(t=t||0)||0;s<e.length;s++)n[s-t]=e[s];return n},Lt=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}},Nt=[].slice,Rt=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=Nt.call(arguments,2);return function(){return t.apply(e,n.concat(Nt.call(arguments)))}},Ot=$(function(e,t){var n=Q("socket.io-client:socket");e.exports=o;var s={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},r=te.prototype.emit;function o(e,t,n){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}te(o.prototype),o.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[Lt(e,"open",Rt(this,"onopen")),Lt(e,"packet",Rt(this,"onpacket")),Lt(e,"close",Rt(this,"onclose"))]}},o.prototype.open=o.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.reconnecting||this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},o.prototype.send=function(){var e=Mt(arguments);return e.unshift("message"),this.emit.apply(this,e),this},o.prototype.emit=function(e){if(s.hasOwnProperty(e))return r.apply(this,arguments),this;var t=Mt(arguments),o={type:(void 0!==this.flags.binary?this.flags.binary:we(t))?fe.BINARY_EVENT:fe.EVENT,data:t,options:{}};return o.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(n("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),o.id=this.ids++),this.connected?this.packet(o):this.sendBuffer.push(o),this.flags={},this},o.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},o.prototype.onopen=function(){if(n("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"==typeof this.query?Je(this.query):this.query;n("sending connect packet with query %s",e),this.packet({type:fe.CONNECT,query:e})}else this.packet({type:fe.CONNECT})},o.prototype.onclose=function(e){n("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},o.prototype.onpacket=function(e){if(e.nsp===this.nsp||e.type===fe.ERROR&&"/"===e.nsp)switch(e.type){case fe.CONNECT:this.onconnect();break;case fe.EVENT:case fe.BINARY_EVENT:this.onevent(e);break;case fe.ACK:case fe.BINARY_ACK:this.onack(e);break;case fe.DISCONNECT:this.ondisconnect();break;case fe.ERROR:this.emit("error",e.data)}},o.prototype.onevent=function(e){var t=e.data||[];n("emitting event %j",t),null!=e.id&&(n("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?r.apply(this,t):this.receiveBuffer.push(t)},o.prototype.ack=function(e){var t=this,s=!1;return function(){if(!s){s=!0;var r=Mt(arguments);n("sending ack %j",r),t.packet({type:we(r)?fe.BINARY_ACK:fe.ACK,id:e,data:r})}}},o.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(n("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):n("bad ack %s",e.id)},o.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},o.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)r.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},o.prototype.ondisconnect=function(){n("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},o.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},o.prototype.close=o.prototype.disconnect=function(){return this.connected&&(n("performing disconnect (%s)",this.nsp),this.packet({type:fe.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},o.prototype.compress=function(e){return this.flags.compress=e,this},o.prototype.binary=function(e){return this.flags.binary=e,this}}),Wt=_t;function _t(e){this.ms=(e=e||{}).min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}_t.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},_t.prototype.reset=function(){this.attempts=0},_t.prototype.setMin=function(e){this.ms=e},_t.prototype.setMax=function(e){this.max=e},_t.prototype.setJitter=function(e){this.jitter=e};var Ut=Q("socket.io-client:manager"),qt=Object.prototype.hasOwnProperty,$t=Ht;function Ht(e,t){if(!(this instanceof Ht))return new Ht(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||Infinity),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new Wt({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=t.parser||fe;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}Ht.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)qt.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},Ht.prototype.updateSocketIds=function(){for(var e in this.nsps)qt.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},Ht.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},te(Ht.prototype),Ht.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},Ht.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},Ht.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},Ht.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},Ht.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},Ht.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},Ht.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},Ht.prototype.open=Ht.prototype.connect=function(e,t){if(Ut("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;Ut("opening %s",this.uri),this.engine=Ft(this.uri,this.opts);var n=this.engine,s=this;this.readyState="opening",this.skipReconnect=!1;var r=Lt(n,"open",function(){s.onopen(),e&&e()}),o=Lt(n,"error",function(t){if(Ut("connect_error"),s.cleanup(),s.readyState="closed",s.emitAll("connect_error",t),e){var n=new Error("Connection error");n.data=t,e(n)}else s.maybeReconnectOnOpen()});if(!1!==this._timeout){var i=this._timeout;Ut("connect attempt will timeout after %d",i),0===i&&r.destroy();var a=setTimeout(function(){Ut("connect attempt timed out after %d",i),r.destroy(),n.close(),n.emit("error","timeout"),s.emitAll("connect_timeout",i)},i);this.subs.push({destroy:function(){clearTimeout(a)}})}return this.subs.push(r),this.subs.push(o),this},Ht.prototype.onopen=function(){Ut("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(Lt(e,"data",Rt(this,"ondata"))),this.subs.push(Lt(e,"ping",Rt(this,"onping"))),this.subs.push(Lt(e,"pong",Rt(this,"onpong"))),this.subs.push(Lt(e,"error",Rt(this,"onerror"))),this.subs.push(Lt(e,"close",Rt(this,"onclose"))),this.subs.push(Lt(this.decoder,"decoded",Rt(this,"ondecoded")))},Ht.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},Ht.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},Ht.prototype.ondata=function(e){this.decoder.add(e)},Ht.prototype.ondecoded=function(e){this.emit("packet",e)},Ht.prototype.onerror=function(e){Ut("error",e),this.emitAll("error",e)},Ht.prototype.socket=function(e,t){var n=this.nsps[e];if(!n){n=new Ot(this,e,t),this.nsps[e]=n;var s=this;n.on("connecting",r),n.on("connect",function(){n.id=s.generateId(e)}),this.autoConnect&&r()}function r(){~It(s.connecting,n)||s.connecting.push(n)}return n},Ht.prototype.destroy=function(e){var t=It(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},Ht.prototype.packet=function(e){Ut("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(n){for(var s=0;s<n.length;s++)t.engine.write(n[s],e.options);t.encoding=!1,t.processPacketQueue()}))},Ht.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},Ht.prototype.cleanup=function(){Ut("cleanup");for(var e=this.subs.length,t=0;t<e;t++)this.subs.shift().destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},Ht.prototype.close=Ht.prototype.disconnect=function(){Ut("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},Ht.prototype.onclose=function(e){Ut("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},Ht.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)Ut("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();Ut("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout(function(){e.skipReconnect||(Ut("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(Ut("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(Ut("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(n)}})}},Ht.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)};var jt=$(function(e,t){var n=Q("socket.io-client");e.exports=t=r;var s=t.managers={};function r(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var r,o=function(e,t){var n=e;t=t||"undefined"!=typeof location&&location,null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(ee("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),ee("parse %s",e),n=V(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";var s=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port,n.href=n.protocol+"://"+s+(t&&t.port===n.port?"":":"+n.port),n}(e),i=o.source,a=o.id;return t.forceNew||t["force new connection"]||!1===t.multiplex||s[a]&&o.path in s[a].nsps?(n("ignoring socket cache for %s",i),r=$t(i,t)):(s[a]||(n("new io instance for %s",i),s[a]=$t(i,t)),r=s[a]),o.query&&!t.query&&(t.query=o.query),r.socket(o.path,t)}t.protocol=fe.protocol,t.connect=r,t.Manager=$t,t.Socket=Ot});const Vt={errors:{initContextUndefined:{code:201,desc:"InitContext is not defined"},envUndefined:{code:202,desc:"Service endpoint environment is not defined"},clientIdUndefined:{code:203,desc:"Client id is not defined"},accessTokenUndefined:{code:204,desc:"Access token is not defined"},accessTokenInvalid:{code:205,desc:"Access token is not valid"},callbacksUndefined:{code:206,desc:"Essential callbacks are not defined"},onSuccessCallbackUndefined:{code:207,desc:"On success callback is not defined"},onFailureCallbackUndefined:{code:208,desc:"On failure callback is not defined"},onMessageCallbackUndefined:{code:209,desc:"On message callback is not defined"},onClientStateCallbackUndefined:{code:210,desc:"On client state callback is not defined"},environmentInvalid:{code:211,desc:"Service endpoint environment is not valid"},wamIsNotInitialized:{code:212,desc:"WAM is not initialized"}}},zt={errors:{ccdNotPresent:{code:101,desc:"Creative cloud desktop is not present"},ccdForWAMConnectionNotPresent:{code:102,desc:"Creative cloud desktop is not available to support WAM connection"},accessTokenInvalidOrExpired:{code:103,desc:"Access token is invalid or expired"},clientAndWAMConnectionTimeout:{code:104,desc:"Timeout occurs in connecting WAM from client"},clientFailedToRegisterAtWAM:{code:105,desc:"Client failed to register at WAM"},ccdConnectionTimeout:{code:106,desc:"Timeout in making connection with Creative cloud desktop via WAM"},userMismatch:{code:107,desc:"User is mismatched between client and Creative cloud desktop"},default:{code:100,desc:"Unable to connect with Creative Cloud Desktop"}}},Xt={errors:{cmdContextUndefined:{code:301,desc:"Command context is not defined"},sapcodeUndefined:{code:302,desc:"Sapcode is not defined in command context"},versionUndefined:{code:303,desc:"Version is not defined in command context"},confirmationIdUndefined:{code:304,desc:"Confirmation Id is not defined in confirmation command context"},confirmationTypeUndefined:{code:305,desc:"Confirmation type is not defined in confirmation command context"},commandPayloadUndefined:{code:306,desc:"Command payload is not defined"},commandUndefined:{code:307,desc:"Command is not defined"},currentDeviceNotFound:{code:308,desc:"Creative Cloud app's deviceId state not detected"},commandNotSupported:{code:309,desc:"Command is not supported. Supported commands are ['install', 'launch', 'uninstall', 'update', 'retry', 'cancel']"},ccdDeepLinkWFUndefined:{code:310,desc:"Workflow name is undefined"},routePathUndefined:{code:311,desc:"routePath parameter is undefined"},docTypeUndefined:{code:312,desc:"DocType is undefined"},docPathUndefined:{code:313,desc:"DocPath is undefined"},uriUndefined:{code:314,desc:"URI is undefined"},CCDVersionError:{code:315,desc:"Newer version of CCD is required to support this feature."}}};var Jt=new class{getBrowserType(){const e=navigator.userAgent;let t,n=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(n[1]))return t=/\brv[ :]+(\d+)/g.exec(e)||[],{name:"IE",version:t[1]||""};if("Chrome"===n[1]&&(t=e.match(/\bOPR|Edge\/(\d+)/),null!=t))return{name:"Opera",version:t[1]};n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(t=e.match(/version\/(\d+)/i))&&n.splice(1,1,t[1]);const s=parseInt(n[1],10);return"Firefox"===n[0]&&s>54?{name:"Firefox"}:"Chrome"===n[0]&&s>60?{name:"Chrome"}:{name:"Unknown"}}isBrowserSupportedForHttpPing(){const e=this.getBrowserType();return"Chrome"===e.name||"Firefox"===e.name}compareVersionNumbers(e,t){const n=e.split(".").map(e=>parseInt(e,10)),s=t.split(".").map(e=>parseInt(e,10)),r=n.length>s.length?n:s;for(let e=0;e<r.length;e++){if(void 0===n[e]?n[e]=0:void 0===s[e]&&(s[e]=0),n[e]>s[e])return 1;if(n[e]<s[e])return-1}return 0}getFFCPassphrase(e){return new Promise((t,n)=>{const s=new XMLHttpRequest,r=`${U[e]}/adobe-ffc-external/core/v1/passphrase?passPhrase=${(new Date).getTime()}`;s.open("GET",r),s.onreadystatechange=function(){s.readyState===XMLHttpRequest.DONE&&(200===s.status?t(s.responseText):n(`${s.status}: ${s.statusText}`))},s.send()})}isMacOS(){return!!navigator.userAgent.toLowerCase().match("mac os x")}isWin(){return-1!==navigator.appVersion.indexOf("Win")}getMacVersion(){const e=navigator.userAgent.toLowerCase();if(e.match("mac os x")){let t,n=e.match(/mac os x (10[_|\.][0-9]+[_|\.][0-9]+)/);return n&&0!==n.length||(n=e.match(/mac os x (10[_|\.][0-9]+)/),n instanceof Array&&(n[1]+=".0")),n&&n.length>0&&(t=n[1],t=t.replace(/_/g,".")),t}return null}atob(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e=String(e).replace(/[\t\n\f\r ]+/g,"");let n,s,r,o="{}";if(!/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/.test(e))return o;o="",e+="==".slice(2-(3&e.length));for(let i=0;i<e.length;)n=t.indexOf(e.charAt(i++))<<18|t.indexOf(e.charAt(i++))<<12|(s=t.indexOf(e.charAt(i++)))<<6|(r=t.indexOf(e.charAt(i++))),o+=64===s?String.fromCharCode(n>>16&255):64===r?String.fromCharCode(n>>16&255,n>>8&255):String.fromCharCode(n>>16&255,n>>8&255,255&n);return o}extractPayloadFromToken(e){if(!e)return!1;const t=e.split(".");let n;if(t&&t.length>2)try{n=JSON.parse(this.atob(t[1]))}catch(e){return!1}return n}uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}getChannelId(){var e=(new Date).getTime();return this.uuidv4()+"-"+e}checkCCDVersionRange(e,t,n){if(!e)return!1;const s=e.split(".");if(s&&s.length>=2){const e=parseInt(s[0]),r=parseInt(s[1]);if(isNaN(e)||isNaN(r))return!1;if(e>t)return!0;if(e===t&&r>=n)return!0}}getHeaders({accessToken:e,clientId:t,appId:n,setXAdobeAppId:s,contentType:r}){const o={};return o["x-api-key"]=t,o.Accept="application/json",e&&(o.Authorization=`Bearer ${e}`),r&&(o["content-type"]=r),s&&(o["x-adobe-app-id"]=n||t),o}checkWAMHealthStatus(e){const t=O[e||"prod"];return new Promise((e,n)=>{const s=new XMLHttpRequest;s.open("GET",`${t}/health`),s.onreadystatechange=function(){s.readyState===XMLHttpRequest.DONE&&(200===s.status?e(!0):n(!1))},s.send()})}encodeDecodeHandler(){const e=e=>(e=e||"")!==decodeURIComponent(e),t=(t,n)=>{if(!t||""===t)return t;const s={},r=t?Object.keys(t):[];for(let o=0;o<r.length;o++){let i=r[o],a=t[i];s[i]=n?e(a)?a:encodeURIComponent(a):e(a)?decodeURIComponent(a):a}return s};return{encode:e=>t(e,!0),decode:e=>t(e,!1)}}},Gt=new class{constructor(){if(this.instance)return this.instance;this.instance=this,this.appId=null,this.appType=null,this.clientId=null,this.accessToken=null,this.userContext={userId:null},this.callbacks={onSuccessCallbacks:[],onFailureCallbacks:[],onMessageCallbacks:[]},this.ccdConnection={error:null},this.isInitialized=!1,this.ccdDetectPromise=null,this.disconnectOnUserMismatch=!0,this.isLoggingEnabled=!1,this.sendAnalytics=!0,this.env="stage"}addCallbacks(e){e.onSuccessCallback&&(this.callbacks.onSuccessCallbacks=this.callbacks.onSuccessCallbacks||[],this.callbacks.onSuccessCallbacks.push(e.onSuccessCallback)),e.onFailureCallback&&(this.callbacks.onFailureCallbacks=this.callbacks.onFailureCallbacks||[],this.callbacks.onFailureCallbacks.push(e.onFailureCallback)),e.onMessageCallback&&(this.callbacks.onMessageCallbacks=this.callbacks.onMessageCallbacks||[],this.callbacks.onMessageCallbacks.push(e.onMessageCallback)),e.onClientStateCallback&&(this.callbacks.onClientStateCallbacks=this.callbacks.onClientStateCallbacks||[],this.callbacks.onClientStateCallbacks.push(e.onClientStateCallback)),e.onCCDDetectionCallback&&(this.callbacks.onCCDDetectionCallback=e.onCCDDetectionCallback),e.onCloseConfirmationCallback&&(this.callbacks.onCloseConfirmationCallback=e.onCloseConfirmationCallback),e.analyticsCallback&&(this.callbacks.analyticsCallback=e.analyticsCallback),e.clientTokenExpiryCheck&&(this.callbacks.clientTokenExpiryCheck||(this.callbacks.clientTokenExpiryCheck=e.clientTokenExpiryCheck)),e.onDisconnect&&(this.callbacks.onDisconnect||(this.callbacks.onDisconnect=e.onDisconnect))}initializeContext(e){return this.isInitialized?{status:!0}:e?e.env?e.clientId?e.callbacks?e.callbacks.onSuccessCallback?e.callbacks.onFailureCallback?e.callbacks.onMessageCallback?O[e.env]?(this.appId=e.appId,this.appType=e.appType,this.env=e.env,this.clientId=e.clientId,this.isLoggingEnabled=e.isLoggingEnabled,void 0!==e.sendAnalytics&&(this.sendAnalytics=e.sendAnalytics),this.disconnectOnUserMismatch=null==e.disconnectOnUserMismatch||e.disconnectOnUserMismatch,this.ccdConnection.error=null,this.addCallbacks(e.callbacks),this.isInitialized=!0,{status:!0}):{status:!1,error:Vt.errors.environmentInvalid}:{status:!1,error:Vt.errors.onMessageCallbackUndefined}:{status:!1,error:Vt.errors.onFailureCallbackUndefined}:{status:!1,error:Vt.errors.onSuccessCallbackUndefined}:{status:!1,error:Vt.errors.callbacksUndefined}:{status:!1,error:Vt.errors.clientIdUndefined}:{status:!1,error:Vt.errors.envUndefined}:{status:!1,error:Vt.errors.initContextUndefined}}initializeUserContext(e){if(!e||!e.accessToken)return{status:!1,error:Vt.errors.accessTokenUndefined};this.accessToken=e.accessToken;const t=Jt.extractPayloadFromToken(e.accessToken);return t&&(this.userContext.userId=t.user_id),this.userContext.userId?(this.userContext.email=e.email,this.userContext.displayName=e.displayName,{status:!0}):{status:!1,error:Vt.errors.accessTokenInvalid}}};const Yt=()=>{function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},Kt=(e,t,n,s)=>({connection:{userId:e,deviceId:s,clientInfo:{id:Yt(),clientType:d,listenTo:[u],userName:t,userEmail:n}}}),Zt=(e,t,n,s)=>{const r=n||"dummy",o=s||"dummy";return{messages:[{id:Yt(),userContext:{userId:e,deviceId:t},clientType:d,msgType:"cc.command",msgContextId:`${r}_${o}`,msgBody:{sapCode:r,version:o,command:"getAppsAndServicesList"},autoContext:{timestamp:(new Date).getTime(),ttl:"medium"},apiVersion:1}]}},Qt=(e,t,n,s)=>{const r=n||"dummy",o=s||"dummy";return{messages:[{id:Yt(),userContext:{userId:e,deviceId:t},clientType:d,msgType:"cc.command",msgContextId:`${r}_${o}`,msgBody:{sapCode:r,version:o,command:"getAppsPanelInstallAvailabilityStatus"},autoContext:{timestamp:(new Date).getTime(),ttl:"medium"},apiVersion:1}]}};class en{constructor(){this.data={"ui.view_type":"App Inline","event.workflow":"bifrost-debug"}}build(){return this.data}subcategory(e){return this.data["event.subcategory"]=e,this}type(e){return this.data["event.type"]=e,this}subtype(e){return this.data["event.subtype"]=e,this}eventValue(e){return this.data["event.value"]=e,this}eventCount(e){return this.data["event.count"]=e,this}frameWork(e){return this.data["env.fw.name"]=e,this}contentName(e){return this.data["content.name"]=e,this}contentCategory(e){return this.data["content.category"]=e,this}contentExtension(e){return this.data["content.extension"]=e,this}viewType(e){return void 0!==e&&(this.data["ui.view_type"]=e),this}errorType(e){return this.data["event.error_type"]=e,this}errorDesc(e){return this.data["event.error_desc"]=e,this}wamTimeProfile(e){return e?(this.data["wam.wamProfileTime"]=JSON.stringify(e),this):this}}var tn=new class{sendEvent({type:e,subtype:t,frameWork:n,eventValue:s,eventCount:r,errorType:o,errorDesc:i,contentName:a,contentCategory:c,contentExtension:l,uiViewType:d,wamTimeProfileData:u}){if(!Gt.sendAnalytics)return;const p=(new en).type(e).subtype(t).eventValue(s).eventCount(r).frameWork(n).errorType(o).errorDesc(i).contentName(a).contentCategory(c).contentExtension(l).viewType(d).wamTimeProfile(u).build();(e=>{if(!Gt.env)return;const t=Gt.env||"stage",n=new XMLHttpRequest;n.open("POST",`${W[t]}?api_key=cchome-web-service`);const s=Jt.getHeaders({accessToken:Gt.accessToken,clientId:_,contentType:"application/json"});for(const e in s)s.hasOwnProperty(e)&&n.setRequestHeader(e,s[e]);const r=(()=>{const e=new Date;let t="",n=-e.getTimezoneOffset();return n>=0?t="+":(t="-",n*=-1),t+=("0"+parseInt(""+n/60)).slice(-2)+("0"+n%60).slice(-2),e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+"T"+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)+"."+(e.getMilliseconds()/1e3).toFixed(3).slice(2,5)+t})(),o={events:[{time:r,project:_,environment:Gt.env,ingesttype:"dumamis",data:Object.assign({"event.category":"WEB","event.dts_end":r,"event.guid":Jt.uuidv4(),"event.referrer":window.location.origin,"event.url":window.location.href,"event.user_agent":window.navigator.userAgent,"event.subcategory":"bifrost-debug"},e)}]};Gt.userContext.userId&&(o.events[0].data["event.user_guid"]=Gt.userContext.userId),Gt.clientId&&(o.events[0].data["source.client_id"]=Gt.clientId),n.send(JSON.stringify(o))})(p),u||Gt.callbacks.analyticsCallback&&Gt.callbacks.analyticsCallback(p)}trackTimeOnCompletion(e,t,n){this.sendEvent({type:"wamWF",subtype:t,eventValue:n,eventCount:e.toString()})}onCCDDetection(e,t){this.sendEvent({type:"ccd-detect",subtype:"ccd-detect-time-taken",eventValue:t.toString(),contentName:e?"ccd-present":"ccd-not-present"})}onCCDNotSupportingWAM(){this.sendEvent({type:"wamWF",subtype:"ccd-not-supporting-wam"})}onExecuteWorkflow(e){this.sendEvent({type:"wamWF",subtype:`${e}-${A.clientIdToAppName[Gt.clientId]}`})}sendAnalytics(e){const t=e=>{this.sendEvent({type:e.eventName,subtype:e.subType,frameWork:e.workflow})},n=e=>{this.sendEvent({type:"api",subtype:"wam",eventValue:e.status,errorType:e.errorType,errorDesc:e.errorDesc})},s=e=>{this.sendEvent({type:"api",subtype:"get-current-device",eventValue:e.status})},r=e=>{this.sendEvent({type:"detect",subtype:"thor",eventValue:e.status})},o=e=>{this.sendEvent({type:"api",subtype:"receive-device-id",eventValue:e.status,errorType:e.errorType,errorDesc:e.errorDesc})},i=e=>{this.sendEvent({type:"api",subtype:"cch-registration-wam",eventValue:e.status,errorType:e.errorType,errorDesc:e.errorDesc})},a=e=>{this.sendEvent({type:"api",subtype:"thor-apps-state",eventValue:e.status,errorType:e.errorType,errorDesc:e.errorDesc})},c=e=>{this.sendEvent({type:e.commandName,subtype:e.commandStage,eventValue:e.eventValue,errorType:e.errorType,errorDesc:e.errorDesc,contentName:e.sapcode,contentCategory:"desktop",contentExtension:e.version,uiViewType:"App Inline:Install"})},l=e=>{this.sendEvent({type:"wamWF",subtype:"wam-time-taken",eventValue:e.eventValue})},d=()=>{this.sendEvent({type:"wamWF",subtype:"conn-failure-in-connected-client"})};switch(e.eventName){case D:case T:t(e);break;case B:n(e);break;case S:s(e);break;case x:r(e);break;case P:o(e);break;case E:i(e);break;case I:a(e);break;case F:case M:c(e);break;case L:l(e);break;case N:d()}}},nn=new class{getAAMPlugin(){let e=null;if(navigator&&navigator.plugins&&(e=Object.values(navigator.plugins).find(e=>e&&e.name&&e.name.toLowerCase().indexOf("adobeaamdetect")>-1)),!e&&"IE"===Jt.getBrowserType().name)try{e=new ActiveXObject("AdobeAAMDetect.AdobeAAMDetect")}catch(e){return null}return e}getAAMPluginVersion(){let e=null,t=null;navigator&&navigator.plugins&&(t=Object.values(navigator.plugins).find(e=>e&&e.name&&e.name.toLowerCase().indexOf("adobeaamdetect")>-1),t&&t.description&&(e=t.description.match(/[0-9]_[0-9]_[0-9]_[0-9]/i),e&&e[0]&&(e=e[0].replace(/_/g,"."))));const n=-1!=navigator.userAgent.indexOf("MSIE")||1==!!document.documentMode;if(!t&&n)try{t=new ActiveXObject("AdobeAAMDetect.AdobeAAMDetect"),t&&t.version&&(e=t.version.match(/[0-9].[0-9].[0-9].[0-9]/i),e&&e[0]&&(e=e[0]))}catch(e){return null}return e}aamPluginSupportsAmpersand(){const e=this.getAAMPluginVersion();return e&&Jt.compareVersionNumbers(e,"3.0.0.0")>=0}checkForCCD(e){const t=(t,n)=>{let s=0;const r=n&&n.portToConnectWithCCD&&n.portToConnectWithCCD.length>0?n.portToConnectWithCCD:["15292","35691","57921"];let o,i=0,a=!1;function c(t){let n="/stage/";const s=e&&e.env;return void 0!==s&&"prod"===s&&(n="/"),`https://detect.ffc.adobeoobe.com:${t}${n}cc.png?arg=${Math.random()}`}function l(e,t){return t.pingType===C?`http://127.0.0.1:${e}/cc.png?type=${t.pingType}&arg=${Math.random()}`:t.pingType===v?`http://127.0.0.1:${e}/cc.png?type=${t.pingType}&channelGuid=${t.channelGuid}&arg=${Math.random()}`:void 0}o=setTimeout(()=>{d(!1)},1e4);const d=e=>{o&&(clearTimeout(o),o=null),a=!0,t(e)},u=()=>{d(!0)},p=()=>{i++,i===r.length&&d(!1)},h=()=>{d(!1)},f=[];for(;s<r.length;){if(f[s]=document.createElement("img"),!n||n.pingType!==C&&n.pingType!==v||(f[s].referrerPolicy="origin"),f[s].src=n&&n.pingType?l(r[s],n):c(r[s]),f[s].fetchPriority="high",f[s].onload=u,f[s].onerror=p,f[s].onexception=h,self&&self.crossOriginIsolated&&(f[s].crossOrigin="anonymous"),a)return;s++}};return new Promise(n=>{const s={},r=["16494","35693","57923"];e&&e.version===k?(s.portToConnectWithCCD=["15393","35692","57922"],t(n,s)):e&&e.version===w&&e.pingType===C?(s.portToConnectWithCCD=r,s.pingType=C,t(n,s)):e&&e.version===w&&e.pingType===v?(s.portToConnectWithCCD=r,s.pingType=v,s.channelGuid=e.channelGuid,t(n,s)):this.getAAMPlugin()?n(!0):t(n)})}},sn=new class{reset(){this.client="Web",this.shouldSendEvent=!1,this.stepsAndTime={timeTakenInCCDDetect:-1,timeTakenToCheckHttpPing:-1,webToWAMConnectTime:-1,timeTakenInGetCurrentDevice:-1,timeTakenInRevCurrentDeviceFromCCD:-1,timeTakenInWAMV1DetectCall:-1,timeTakenInWAMV2InitiateCall:-1,authenticationTime:-1,webClientRegistrationTime:-1,timeTakenInReceivingAppsList:-1}}sendEvent(){this.shouldSendEvent&&(Gt.ccdDetectPromise||(Gt.ccdDetectPromise=In({env:Gt.env})),Gt.ccdDetectPromise.then(e=>{e&&tn.sendEvent({type:"wam",subtype:"wam-time-profile",wamTimeProfileData:(e=>{const t=Object.assign({},e);return delete t.startTime,delete t.shouldSendEvent,e.wf===A.wf.v2?(delete t.stepsAndTime.timeTakenInGetCurrentDevice,delete t.stepsAndTime.timeTakenInRevCurrentDeviceFromCCD,delete t.stepsAndTime.timeTakenInWAMV1DetectCall):delete t.stepsAndTime.timeTakenInWAMV2InitiateCall,t})(this)})}))}};let rn,on,an;var cn=new class{constructor(){if(this.instance)return this.instance;this.instance=this,this.environment=null}isCCDAppsPanelLoaded(){return wn()===l.ccdAppsState.loaded}isCCDAppsPanelLoading(){return wn()===l.ccdAppsState.appRefreshedStarted||wn()===l.ccdAppsState.loading}isCCDAppListPresent(){return null!==Cn()}areClientsConnected(){return un.isCCHReadyToRecvData()&&this.isCCDAppsPanelLoaded()}areClientsConnectedOrAppsPanelLoading(){return un.isCCHReadyToRecvData()&&(this.isCCDAppsPanelLoaded()||this.isCCDAppsPanelLoading())}printLog(e){Gt.isLoggingEnabled&&console.log(e)}appendSourceInDesc(e){return un.sourceOFWAMConnection?`${e} | source: ${un.sourceOFWAMConnection}`:e}isTokenValid(){if(Gt.callbacks.clientTokenExpiryCheck){const e=Gt.callbacks.clientTokenExpiryCheck();if(null!=e)return e}return!0}shouldSendAnalytics(e){return e.sendAnalytics}sendAnalyticsOnTimeout(e){if(un.doesCCDSupportInline){const t=un.currentDevice&&un.currentDevice.deviceId,n=this.areClientsConnected(),s=un.isWebClientRegistered;if(!Gt.ccdConnection.error&&(Gt.ccdConnection.error=zt.errors.ccdConnectionTimeout.desc),!n&&!un.wamConnectionAnalyticsParams.recvCCDAppsState){const n=this.appendSourceInDesc(`timeout on client side. Apps state:${wn()}. Current Device ${t?"received":"not received"}. CCH ${s?"registered":"not registered"}`);this.printLog(n),this.shouldSendAnalytics(e)&&tn.sendAnalytics({eventName:I,status:"false",errorType:"timeout",errorDesc:n}),un.wamConnectionAnalyticsParams.recvCCDAppsState="timeout"}if(!t&&!un.wamConnectionAnalyticsParams.recvDeviceId){const t=this.appendSourceInDesc("timeout on client side for receive current device");this.printLog(t),this.shouldSendAnalytics(e)&&tn.sendAnalytics({eventName:P,status:"false",errorType:"timeout",errorDesc:t})}if(!s&&!un.wamConnectionAnalyticsParams.webappRegistered){const t=this.appendSourceInDesc("timeout on client side for CCH registration");this.printLog(t),this.shouldSendAnalytics(e)&&tn.sendAnalytics({eventName:E,status:"false",errorType:"timeout",errorDesc:t})}}else this.shouldSendAnalytics(e)&&tn.onCCDNotSupportingWAM(),this.printLog("CCD is not supporting inline")}exitFromWamWorkflow(e){this.printLog("Exiting from WAM Workflow"),this.sendAnalyticsOnTimeout(e)}waitAsConnectionInProgress(e){let t=!0;return void 0!==e.isLongWaitingEnabled&&(t=e.isLongWaitingEnabled),!t&&e.timeout&&an?new Promise(t=>{const n=setTimeout(()=>{clearInterval(r),this.printLog("Cleared the connection check interval"),this.areClientsConnected()?t(!0):(e.exitConnection&&un.destroySocket(),t(!1))},e.timeout);let s=1;const r=setInterval(()=>this.areClientsConnected()?(clearTimeout(n),clearInterval(r),this.printLog("Resolving the promise and clearing the interval"),void t(!0)):20===s?(clearInterval(r),void this.printLog("Cleared the connection check interval")):void s++,1e3)}):null}initCCDConnectionForWAM(e){const t=[];let n,s=!0;if(void 0!==e.isLongWaitingEnabled&&(s=e.isLongWaitingEnabled),this.isTokenValid()&&!an){an=!0,n=!1;const r=new Promise(t=>{if(this.areClientsConnectedOrAppsPanelLoading())return this.printLog("CCH and CCD are connected or CCD apps panel is loading"),void t(!0);this.printLog("CCH and CCD are not connected, hence destroying the current socket");const n=()=>{un.destroySocket(),un.init(s).then(e=>t(e))};if(e.pingType===y){const t={pingType:v,version:w,channelGuid:Jt.getChannelId(),env:Gt.env};un.channelGuid=t.channelGuid,nn.checkForCCD(t).then(t=>{tn.sendAnalytics({eventName:T,workflow:w,subType:"v2-workflow"}),sn.stepsAndTime.timeTakenInWAMV2InitiateCall=(new Date).getTime()-sn.startTime,sn.wf=A.wf.v2,t?(this.shouldSendAnalytics(e)&&tn.sendAnalytics({eventName:x,status:"true"}),n()):(tn.sendAnalytics({eventName:D,workflow:k,subType:"thor-incompatible"}),sn.wf=A.wf.v1,sn.reasonToGoWithV1=A.ccdIncompatibleForV2,e.pingType=b,n())})}else n()}).then(t=>t?this.areClientsConnectedOrAppsPanelLoading()?(this.printLog("CCH and CCD are already connected"),t):(this.printLog("Sending WAM event true"),tn.sendAnalytics({eventName:B,status:"true"}),un.reset(),e.pingType===y?un.executeWAMV2Workflow(s,e):un.executeWAMV1Workflow(s,e)):(this.printLog("Connection with WAM couldn't be established"),!1)).then(t=>(!1===n&&(this.printLog(t?"Connection established":"Connection could not established"),t||(this.exitFromWamWorkflow(e),un.destroySocket())),an=!1,n=!0,t)).catch(()=>(!1===n&&(this.printLog("Connection could not established"),this.exitFromWamWorkflow(e),un.destroySocket()),an=!1,n=!0,!1));t.push(r)}const r=this.waitAsConnectionInProgress(e);return r&&(r.then(()=>{!1===n&&(this.printLog("Timeout occurs"),this.sendAnalyticsOnTimeout(e)),an=!1,n=!0}),t.push(r)),0===t.length&&t.push(new Promise(e=>e(!1))),Promise.race(t)}shouldRefreshCCHOnCCDDetection(e,t){!e&&t.retryWAMConnection&&(rn||(on=0,t.sendAnalytics=!1,rn=setInterval(()=>{this.initCCDConnectionForWAM(t).then(e=>{e?clearInterval(rn):(on++,on>=60&&clearInterval(rn))})},12e3)))}triggerCCDByPingType(e,t,n){void 0===e.sendAnalytics&&(e.sendAnalytics=!0),e.pingType=t,this.initCCDConnectionForWAM(e).then(t=>{t&&(sn.stepsAndTime.timeTakenInReceivingAppsList=(new Date).getTime()-sn.startTime),n(t),this.shouldRefreshCCHOnCCDDetection(t,e)})}initCCDConnection(e){return this.printLog(e),sn.reset(),Gt.ccdConnection={error:null},new Promise(t=>{return n=this,r=function*(){if(!window.navigator.onLine)return void t(!1);if(this.areClientsConnected()){try{const e=yield un.checkWAMHealthStatus();t(e)}catch(e){this.printLog(`WAM health call is failing in initCCDConnection, health status call is ${e}`),tn.sendAnalytics({eventName:N}),t(!1)}return}const n=this.waitAsConnectionInProgress(e);if(n)return an=!1,void n.then(e=>{t(e)});sn.shouldSendEvent=!0,sn.subClient=A.clientIdToAppName[Gt.clientId],sn.subClient||(sn.subClient="not-known"),sn.startTime=(new Date).getTime(),sn.timeStamp=(new Date).toString(),Jt.isBrowserSupportedForHttpPing()?performance&&performance.getEntriesByType("navigation")[0]&&"reload"===performance.getEntriesByType("navigation")[0].type?setTimeout(()=>{sn.startTime=(new Date).getTime(),sn.timeStamp=(new Date).toString(),this.triggerCCDByPingType(e,y,t)},500):this.triggerCCDByPingType(e,y,t):(tn.sendAnalytics({eventName:D,workflow:k,subType:"browser-incompatible"}),sn.wf=A.wf.v1,sn.reasonToGoWithV1=A.browserIncompatibleForV2,this.triggerCCDByPingType(e,b,t))},new((s=void 0)||(s=Promise))(function(e,t){function o(e){try{a(r.next(e))}catch(e){t(e)}}function i(e){try{a(r.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s(function(e){e(n)})).then(o,i)}a((r=r.apply(n,[])).next())});var n,s,r})}};let ln,dn;var un=new class{constructor(){if(this.instance)return this.instance;this.instance=this,this.wamConnectionAnalyticsParams={recvCCDAppsState:"failure",recvDeviceId:"failure",webappRegistered:"failure"},this.doesCCDSupportInline=null,this.sourceOFWAMConnection=null,this.onClientMessageHooks={},window&&window.addEventListener("offline",()=>this.destroySocket()),window&&window.addEventListener("online",()=>{this.reconnectToCCD("online")})}reconnectToCCD(e,t){return n=this,r=function*(){if(this.sourceOFWAMConnection)cn.printLog(`Ignoring reconnect to CCD attempt for: ${e}, as it is being exeucted by: ${this.sourceOFWAMConnection} or already connected.`);else if(window.navigator.onLine)if(cn.isTokenValid())if(cn.areClientsConnected())try{yield this.checkWAMHealthStatus(),this.sourceOFWAMConnection=null,cn.printLog(`${e} event is ignored as clients are already connected`)}catch(e){this.destroySocket()}else new Promise((n,s)=>{this.sourceOFWAMConnection=e,cn.printLog(`Pinging CCD as CCD disconnected, source type: ${e}`),cn.initCCDConnection(t||{timeout:1e4});let r=1;const o=setInterval(()=>cn.areClientsConnected()?(clearInterval(o),cn.printLog(`Connection with CCD established, source type: ${e}`),void n(!0)):3===r?(clearInterval(o),cn.printLog(`Connection with CCD couldn't be established, source type: ${e}`),void s(!1)):(cn.printLog(`Pinging CCD as CCD disconnected, source type: ${e}`),cn.initCCDConnection(t||{timeout:1e4}),void r++),3e4)}).then(()=>{this.sourceOFWAMConnection=null}).catch(()=>{this.sourceOFWAMConnection=null});else this.destroySocket();else this.destroySocket()},new((s=void 0)||(s=Promise))(function(e,t){function o(e){try{a(r.next(e))}catch(e){t(e)}}function i(e){try{a(r.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s(function(e){e(n)})).then(o,i)}a((r=r.apply(n,[])).next())});var n,s,r}init(e){if(this.socket&&this.socket.connected)return new Promise(e=>{cn.printLog("Socket is already connected"),e(!!this.socket.connected)});const t=e=>{this.destroySocket(),this.socket=this.socket=jt.connect(O[Gt.env],{path:"/v2/ws",reconnection:!1,transports:["websocket"],query:`api_key=${Gt.clientId}`}),this.setErrorCallback(e),this.setConnectErrorCallback(e)},n=e=>{this.reset(),this.removeEvents(),this.setCallbackForClientState(),this.setCallbackForClientMsg(),this.setDisconnectionCallback(),e(!!this.socket.connected)};return new Promise(s=>{const r=(new Date).getTime();t(s),this.socket?(setTimeout(()=>{this.socket&&this.socket.connected||(cn.printLog("Connection of client with WAM couldn't be established"),!Gt.ccdConnection.error&&(Gt.ccdConnection.error=zt.errors.clientAndWAMConnectionTimeout.desc),s(!1))},e?g:2e4),cn.printLog("New socket has been initialized"),this.socket.on(o,()=>{cn.printLog("Socket on connect is called");const e=(new Date).getTime(),t=e-r;sn.stepsAndTime.webToWAMConnectTime=t,tn.trackTimeOnCompletion(t,"web-to-wam-connect-time-taken"),this.socket.emit("authenticate",{authorization:`${Gt.accessToken}`,"x-adobe-app-id":Gt.clientId},t=>{const r=(new Date).getTime()-e;tn.trackTimeOnCompletion(r,"web-to-wam-authenticate-time-taken",t.authenticated),sn.stepsAndTime.authenticationTime=r,t.authenticated?(cn.printLog("CreativeCloudHome connection is authenticated"),n(s)):(!Gt.ccdConnection.error&&(Gt.ccdConnection.error=zt.errors.accessTokenInvalidOrExpired.desc),s(!1))})})):s(!1)})}disconnect(){this.socket&&this.socket.connected&&this.socket.disconnect(),this.reset(),this.removeEvents()}reset(){this.currentDevice=null,this.isWebClientRegistered=null,this.wamConnectionAnalyticsParams={recvCCDAppsState:"failure",recvDeviceId:"failure",webappRegistered:"failure"},this.doesCCDSupportInline=null,Tn()}destroySocket(){this.socket&&(this.reset(),this.removeEvents(),this.socket.off(o),this.socket.off(i),this.socket.off(a),ln=0,this.socket.disconnect(),this.socket=null)}removeEvents(){this.socket&&(this.socket.off(s),this.socket.off(n),this.socket.off(r))}isCCHReadyToRecvData(){return this.socket&&this.socket.connected&&this.currentDevice&&this.isWebClientRegistered}setErrorCallback(e){this.socket&&(this.socket.hasListeners(i)||this.socket.on(i,t=>{cn.printLog("Error received from socket"),this.sendAnalyticsInErrState("error",t),Jt.checkWAMHealthStatus(Gt.env).then(()=>{ln=ln||0,ln>=5&&(this.destroySocket(),e(!1)),ln++}).catch(()=>e(!1))}))}sendAnalyticsInErrState(e,t){let n=t;t&&"string"!=typeof t&&(n=JSON.stringify(t)),n||(n="unknown"),n=cn.appendSourceInDesc(n),cn.printLog(`socket error desc ${n}`),dn||(tn.sendAnalytics({eventName:B,status:"false",errorType:e,errorDesc:n}),dn=!0)}setConnectErrorCallback(e){this.socket&&(this.socket.hasListeners(a)||this.socket.on(a,t=>{cn.printLog("Connect_error received from socket"),this.sendAnalyticsInErrState("timeout",t),this.destroySocket(),e(!1)}))}setDisconnectionCallback(){this.socket&&(this.socket.hasListeners(c)||this.socket.on(c,e=>{cn.printLog(`socket disconnected due to: ${e}`),this.reset(),this.removeEvents(),Gt.callbacks.onDisconnect&&Gt.callbacks.onDisconnect()}))}verifyCCDStateAndRegisterCallback({wamConfig:e,isLongWaitingEnabled:t,resolve:n,reject:s}){if(cn.areClientsConnected())return cn.printLog("Sending analytics true for CCD apps state. Got success in first attempt"),cn.shouldSendAnalytics(e)&&tn.sendAnalytics({eventName:I,status:"true"}),this.wamConnectionAnalyticsParams.recvCCDAppsState="success",void n(!0);const r=setTimeout(()=>{cn.areClientsConnected()||(!Gt.ccdConnection.error&&(Gt.ccdConnection.error=zt.errors.ccdConnectionTimeout.desc),s(!1))},t?g:2e4);this.onCCDAppsStatusLoaded=()=>{cn.areClientsConnected()&&(cn.printLog("Sending analytics true for CCD apps state"),cn.shouldSendAnalytics(e)&&tn.sendAnalytics({eventName:I,status:"true"}),this.wamConnectionAnalyticsParams.recvCCDAppsState="success",cn.printLog("Received CCD app state response"),n(!0)),this.onCCDAppsStatusLoaded=null,clearTimeout(r)}}executeWAMV1Workflow(s,r){return new Promise((o,i)=>{if(!this.socket)return void i(!1);this.verifyCCDStateAndRegisterCallback({wamConfig:r,isLongWaitingEnabled:s,resolve:o,reject:i}),cn.printLog(`channelGuid: ${this.channelGuid}`),sn.id=Gt.userContext.userId;const a=(new Date).getTime();this.socket.emit("getCurrentDevice",s=>{const o=(new Date).getTime()-a;if(tn.trackTimeOnCompletion(o,"get-current-device-time-taken"),sn.stepsAndTime.timeTakenInGetCurrentDevice=o,cn.printLog(`getCurrentDevice response: ${s}`),this.socket.hasListeners(n)||this.socket.on(n,n=>{const s=(new Date).getTime()-a;if(tn.trackTimeOnCompletion(s,"receive-current-device-time-taken"),sn.stepsAndTime.timeTakenInRevCurrentDeviceFromCCD=s,!n)return this.wamConnectionAnalyticsParams.recvDeviceId="failure",cn.shouldSendAnalytics(r)&&tn.sendAnalytics({eventName:P,status:"false",errorType:"error",errorDesc:cn.appendSourceInDesc("CCD failed to respond")}),void i(!1);this.wamConnectionAnalyticsParams.recvDeviceId="success",cn.shouldSendAnalytics(r)&&tn.sendAnalytics({eventName:P,status:"true"}),cn.printLog("sendCurrentDevice response: "+(n?"successful":"unsuccessful")),this.currentDevice=n.currentDevice;const o=(new Date).getTime(),c=Zt(Gt.userContext.userId,this.currentDevice.deviceId),l=Qt(Gt.userContext.userId,this.currentDevice.deviceId);if(this.isCCHReadyToRecvData())cn.printLog("CCHome is already registered, hence sending request for AppsPanel status"),this.socket.emit(t,l),cn.printLog("CCHome is already registered, hence sending request for CCD apps state"),this.socket.emit(t,c);else{const n=Kt(Gt.userContext.userId,Gt.userContext.displayName,Gt.userContext.email,this.currentDevice.deviceId);this.socket.emit(e,n,e=>{const n=(new Date).getTime()-o;if(tn.trackTimeOnCompletion(n,R,e),sn.stepsAndTime.webClientRegistrationTime=n,cn.printLog(`Register reponse: ${e}`),e)return this.isWebClientRegistered=!0,cn.printLog(`Sending analytics for CCH registration with WAM: ${e}`),cn.shouldSendAnalytics(r)&&tn.sendAnalytics({eventName:E,status:"true"}),this.wamConnectionAnalyticsParams.webappRegistered="success",cn.printLog("CCHome is registered, hence sending request for AppsPanel status"),this.socket.emit(t,l),void this.socket.emit(t,c);!Gt.ccdConnection.error&&(Gt.ccdConnection.error=zt.errors.clientFailedToRegisterAtWAM.desc),i(!1)})}}),s){cn.shouldSendAnalytics(r)&&tn.sendAnalytics({eventName:S,status:"true"});const e={pingType:"thor",version:k,env:Gt.env},t=(new Date).getTime();nn.checkForCCD(e).then(e=>{const n=(new Date).getTime()-t;if(tn.trackTimeOnCompletion(n,"ccd-trigger-time-taken",e.toString()),sn.stepsAndTime.timeTakenInWAMV1DetectCall=n,this.doesCCDSupportInline=e,sn.ccdState=e?A.ccdStates.signedIn:A.ccdStates.signedOut,!e)return cn.shouldSendAnalytics(r)&&tn.sendAnalytics({eventName:x,status:"false"}),!Gt.ccdConnection.error&&(Gt.ccdConnection.error=zt.errors.ccdForWAMConnectionNotPresent.desc),void i(!1);cn.shouldSendAnalytics(r)&&tn.sendAnalytics({eventName:x,status:"true"}),cn.printLog(`CCD ping response: ${e}`)})}else cn.shouldSendAnalytics(r)&&tn.sendAnalytics({eventName:S,status:"false"})})})}executeWAMV2Workflow(n,s){return new Promise((r,o)=>{if(!this.socket)return void o(!1);this.verifyCCDStateAndRegisterCallback({wamConfig:s,isLongWaitingEnabled:n,resolve:r,reject:o}),cn.printLog(`channelGuid: ${this.channelGuid}`),sn.id=this.channelGuid,sn.ccdState=A.ccdStates.signedIn,this.currentDevice={deviceId:this.channelGuid};const i=(new Date).getTime(),a=Zt(Gt.userContext.userId,this.currentDevice.deviceId),c=Qt(Gt.userContext.userId,this.currentDevice.deviceId);if(this.isCCHReadyToRecvData())cn.printLog("CCHome is already registered, hence sending request for AppsPanel status"),this.socket.emit(t,c),cn.printLog("CCHome is already registered, hence sending request for CCD apps state"),this.socket.emit(t,a);else{const n=Kt(Gt.userContext.userId,Gt.userContext.displayName,Gt.userContext.email,this.currentDevice.deviceId);this.socket.emit(e,n,e=>{const n=(new Date).getTime()-i;if(tn.trackTimeOnCompletion(n,R,e),sn.stepsAndTime.webClientRegistrationTime=n,cn.printLog(`Register reponse: ${e}`),e)return this.isWebClientRegistered=!0,cn.printLog(`Sending analytics for CCH registration with WAM: ${e}`),cn.shouldSendAnalytics(s)&&tn.sendAnalytics({eventName:E,status:"true"}),this.wamConnectionAnalyticsParams.webappRegistered="success",cn.printLog("CCHome is registered, hence sending request for AppsPanel status"),this.socket.emit(t,c),void this.socket.emit(t,a);!Gt.ccdConnection.error&&(Gt.ccdConnection.error=zt.errors.clientFailedToRegisterAtWAM.desc),o(!1)})}})}setCallbackForClientMsg(){this.socket&&(this.socket.hasListeners(s)||this.socket.on(s,e=>{e&&e.messages&&e.messages.forEach(e=>{e&&e.msgBody&&Gt.callbacks.onMessageCallbacks&&Gt.callbacks.onMessageCallbacks.forEach(t=>{e.msgBody.status&&e.msgBody.status.status&&(this.onClientMessageHooks[e.msgBody.status.status]&&((0,this.onClientMessageHooks[e.msgBody.status.status])(),this.onClientMessageHooks[e.msgBody.status.status]=null),An(e.msgBody.status),e.msgBody.status.status===l.ccdAppsState.loaded&&(bn(e),vn(e),this.onCCDAppsStatusLoaded&&this.onCCDAppsStatusLoaded())),t(e)})})}))}setCallbackForClientState(){this.socket&&(this.socket.hasListeners(r)||this.socket.on(r,e=>{cn.printLog(e),e&&e.clientStates&&e.clientStates.forEach(e=>{if(Gt.callbacks.onClientStateCallbacks&&Gt.callbacks.onClientStateCallbacks.forEach(t=>{t(e)}),cn.printLog(e),null!==this.currentDevice&&e.deviceId===this.currentDevice.deviceId&&e.clientType===u){if(e.userMismatch&&Gt.disconnectOnUserMismatch)return cn.printLog("Disconnecting as user is mismatched"),tn.sendAnalytics({eventName:I,status:"false",errorType:"usermismatch",errorDesc:"Usermismatch on client side"}),!Gt.ccdConnection.error&&(Gt.ccdConnection.error=zt.errors.userMismatch.desc),this.wamConnectionAnalyticsParams.recvCCDAppsState="usermismatch",sn.ccdState=A.ccdStates.userMismatch,void this.disconnect();!1===e.connected&&(this.disconnect(),this.reconnectToCCD("ccdDisconnect"))}})}))}checkWAMHealthStatus(){return new Promise((e,n)=>{const s=Qt(Gt.userContext.userId,this.currentDevice.deviceId);this.onClientMessageHooks[l.appsPanelInstallAvailabilityStatus]=((e,t,s)=>{let r=!1;const o=setTimeout(()=>{r||(r=!0,n(!1))},2e3);return(...t)=>{r||(r=!0,clearTimeout(o),e.apply(this,t))}})(()=>{e(!0)}),this.socket.emit(t,s)})}};const pn={};let hn,fn,mn,gn=l.ccdAppsState.cchDefault,yn=null;const Cn=()=>hn,vn=e=>{if(!e||!e.msgBody||!e.msgBody.status)return;const t=e.msgBody.status;try{hn=JSON.parse(t.listingDetails)}catch(e){cn.printLog("Error in parsing product list data from CCD")}},bn=e=>{mn=e},kn=()=>mn,wn=()=>gn,An=e=>{if(e&&e.status)switch(e.status){case l.ccdAppsState.loading:case l.ccdAppsState.appRefreshedStarted:case l.ccdAppsState.loadingFailed:case l.ccdAppsState.loaded:gn=e.status;break;case l.appsPanelInstallAvailabilityStatus:yn=e.appsPanelHidden}},Dn=(e,t)=>{un.socket&&un.socket.emit(e,t)},Tn=()=>{gn=l.ccdAppsState.cchDefault},Sn=(e,t,n,s)=>{if(!e||0===Object.keys(e).length)return null;const r=(e,t,n,s,r)=>{if(!e||!e[t])return null;if(n&&s){const r=e[t].filter(e=>e.sapcode===n&&e.version===s);if(r.length>0)return r[0].stateCategory=t,r[0]}else if(r){const n=e=>e&&e.status===l.needConfirmation&&e.confirmationDetails&&e.confirmationDetails.confirmationID===r,s=e[t].filter(e=>n(e));if(s.length>0)return t===p&&(s[0].stateCategory=t),s[0]}return null},o=r(e,"active_sessions",t,n,s)||r(e,"available_to_install",t,n,s)||r(e,"available_updates",t,n,s)||r(e,h,t,n,s)||r(e,"incompatible",t,n,s)||r(e,p,t,n,s)||r(e,"incompatible_apps",t,n,s);if(null!=o)return o;if(t&&n){if(!fn)return null;const e=fn.filter(e=>e.sapcode===t&&e.version===n);if(e.length>0)return{sapcode:e[0].sapcode,version:e[0].version,status:e[0].status,id:Jt.uuidv4(),stateCategory:"appUnknown"}}return null};var xn=new class{getUpdateDecription({sapCode:e,version:t,platform:n,env:s,xAdobeAppId:r,locale:o}){return new Promise((i,a)=>{const c=new XMLHttpRequest,l=`${q[s]}/core/v1/update/description?name=${e}&version=${t}&platform=${n}&language=${o}&arg=${Math.random()}`;c.open("GET",l);const d=Jt.getHeaders({clientId:r,setXAdobeAppId:!0});for(const e in d)d.hasOwnProperty(e)&&c.setRequestHeader(e,d[e]);c.onreadystatechange=function(){if(c.readyState===XMLHttpRequest.DONE)if(200===c.status){let e;try{e=JSON.parse(c.responseText)}catch(e){a(c.responseText)}i(e)}else a(`${c.status}: ${c.statusText}`)},c.send()})}};const In=(e,t)=>{if(!t&&Gt.ccdDetectPromise)return Gt.ccdDetectPromise;const n=(new Date).getTime(),s=nn.checkForCCD(e);return s.then(e=>{const t=(new Date).getTime()-n;tn.onCCDDetection(e,t)}),Gt.ccdDetectPromise=s,s},Pn=(e,t,n)=>new Promise((s,r)=>{const o=t(e);o.status?(Gt.ccdDetectPromise=In({env:Gt.env}),cn.initCCDConnection({timeout:1e4,isLongWaitingEnabled:!1}).then(t=>{if(sn.status=t?A.status.success:A.status.failure,sn.totalTimeTaken=(new Date).getTime()-sn.startTime,sn.sendEvent(),t){const t=n(e);t.status?s(t):r(t)}else cn.printLog("Failure in executing command"),r(Gt.ccdConnection.error?{status:!1,error:Gt.ccdConnection.error}:{status:!1,error:zt.errors.default})})):r(o)});let En;const Bn={attemptConnection:e=>{if(!Gt.isInitialized)return Gt.callbacks.onFailureCallbacks&&Gt.callbacks.onFailureCallbacks.forEach(e=>{e({status:!1,error:Vt.errors.wamIsNotInitialized})}),{status:!1,error:Vt.errors.wamIsNotInitialized};const t=Gt.initializeUserContext(e);if(!t.status)return Gt.callbacks.onFailureCallbacks&&Gt.callbacks.onFailureCallbacks.forEach(e=>{e(t)}),t;if(En)return{status:!0};En=!0;const n=(new Date).getTime();return cn.initCCDConnection({timeout:1e4,exitConnection:!0,isLongWaitingEnabled:!1}).then(e=>{En=!1;const t=(new Date).getTime()-n;sn.status=e?A.status.success:A.status.failure,sn.totalTimeTaken=(new Date).getTime()-sn.startTime,sn.sendEvent(),e?(tn.sendAnalytics({eventName:L,eventValue:t.toString()}),Gt.callbacks.onSuccessCallbacks&&Gt.callbacks.onSuccessCallbacks.forEach(e=>{e({status:!0,timeTakenInWAMWF:t})}),Gt.callbacks.onMessageCallbacks&&Gt.callbacks.onMessageCallbacks.forEach(e=>{e(kn())})):Gt.callbacks.onFailureCallbacks&&Gt.callbacks.onFailureCallbacks.forEach(e=>{e(Gt.ccdConnection.error?{status:!1,error:Gt.ccdConnection.error,timeTakenInWAMWF:t}:{status:!1,error:zt.errors.default,timeTakenInWAMWF:t})})}),{status:!0}},init:e=>{let t;if(Gt.isInitialized){const n=(new Date).getTime();Gt.addCallbacks(e.callbacks);const s=()=>{if(!e.callbacks)return;const t=(new Date).getTime()-n;tn.sendAnalytics({eventName:L,eventValue:t.toString()}),e.callbacks.onSuccessCallback&&e.callbacks.onSuccessCallback({status:!0,timeTakenInWAMWF:t}),e.callbacks.onMessageCallback&&e.callbacks.onMessageCallback(kn())},r=()=>{const t=(new Date).getTime()-n;e.callbacks&&e.callbacks.onFailureCallback&&e.callbacks.onFailureCallback(Gt.ccdConnection.error?{status:!1,error:Gt.ccdConnection.error,timeTakenInWAMWF:t}:{status:!1,error:zt.errors.default,timeTakenInWAMWF:t})};cn.areClientsConnected()?un.checkWAMHealthStatus().then(()=>s()).catch(()=>r()):!1===En?(r(),t={status:!1}):t={status:!0}}else t=Gt.initializeContext(e),t.status||e.callbacks&&e.callbacks.onFailureCallback&&e.callbacks.onFailureCallback(t);return t},initialize:e=>{const t=Bn.init(e);if(!t.status)return t;const n=Bn.attemptConnection(e.userContext);return n.status?{status:!0}:n},areClientsConnected:()=>cn.areClientsConnected(),sendCommand:e=>Pn(e,e=>{if(!e)return{status:!1,error:Xt.errors.cmdContextUndefined};if(!e.sapCode)return{status:!1,error:Xt.errors.sapcodeUndefined};if(!e.version)return{status:!1,error:Xt.errors.versionUndefined};if(e.isConfirmationType){if(!e.confirmationId)return{status:!1,error:Xt.errors.confirmationIdUndefined};if(!e.confirmationType)return{status:!1,error:Xt.errors.confirmationTypeUndefined}}else{if(!e.commandPayload)return{status:!1,error:Xt.errors.commandPayloadUndefined};if(!e.commandPayload.command)return{status:!1,error:Xt.errors.commandUndefined};if(!m[e.commandPayload.command])return{status:!1,error:Xt.errors.commandNotSupported}}return{status:!0}},e=>{if(!un.currentDevice||!un.currentDevice.deviceId)return{status:!1,error:Xt.errors.currentDeviceNotFound};let n;return n=e.isConfirmationType?(({userId:e,deviceId:t,sapCode:n,version:s,confirmationID:r,confirmationType:o,confirmationValue:i,confirmationCheckboxes:a,ingestContext:c})=>({messages:[{id:Yt(),userContext:{userId:e,deviceId:t},clientType:d,clientSubType:Gt.clientId,msgType:"cc.confirmationResponse",msgContextId:`${n}_${s}`,msgBody:{sapCode:n,version:s,confirmationID:r,confirmationType:o,confirmationValue:i,confirmationCheckboxes:a,ingestContext:c},autoContext:{timestamp:(new Date).getTime(),ttl:"medium"},apiVersion:1}]}))({userId:Gt.userContext.userId,deviceId:un.currentDevice.deviceId,sapCode:e.sapCode,version:e.version,confirmationID:e.confirmationId,confirmationType:e.confirmationType,confirmationValue:e.confirmationBtnVal,confirmationCheckboxes:e.confirmationCheckboxes,ingestContext:e.ingestContext}):(({userId:e,deviceId:t,sapCode:n,moduleId:s,version:r,commandPayload:o,ingestContext:i})=>{const a={messages:[{id:Yt(),userContext:{userId:e,deviceId:t},clientType:d,clientSubType:Gt.clientId,msgType:"cc.command",msgContextId:`${n}_${r}`,msgBody:{sapCode:n,version:r,moduleId:s,ingestContext:i,command:""},autoContext:{timestamp:(new Date).getTime(),ttl:"medium"},apiVersion:1}]};return o&&(o.command&&(a.messages[0].msgBody.command=o.command),o.context&&(a.messages[0].msgBody.context=o.context),o.showDialog&&(a.messages[0].msgBody.showDialog=o.showDialog)),a})({userId:Gt.userContext.userId,deviceId:un.currentDevice.deviceId,sapCode:e.sapCode,version:e.version,moduleId:e.moduleId,commandPayload:e.commandPayload,ingestContext:e.ingestContext}),delete pn[`${e.sapCode}_${e.version}`],cn.printLog(`Command: ${JSON.stringify(n)}`),Dn(t,n),{status:!0}}),executeWorkflow:e=>Pn(e,e=>{if(!e)return{status:!1,error:Xt.errors.cmdContextUndefined};if(!e.workflow)return{status:!1,error:Xt.errors.ccdDeepLinkWFUndefined};switch(e.workflow){case"openDoc":if(!e.docType)return{status:!1,error:Xt.errors.docTypeUndefined};if(!e.docPath)return{status:!1,error:Xt.errors.docPathUndefined};if(!e.sapCode)return{status:!1,error:Xt.errors.sapcodeUndefined};break;case"routePath":if(!e.routePath)return{status:!1,error:Xt.errors.routePathUndefined}}return Jt.checkCCDVersionRange(Gt.ccdVersion,5,7)?{status:!0}:{status:!1,error:`${Xt.errors.CCDVersionError}. Please install CCD version >=5.7`}},e=>{if(!un.currentDevice||!un.currentDevice.deviceId)return{status:!1,error:Xt.errors.currentDeviceNotFound};const n=((e,t,n)=>({messages:[{id:Yt(),userContext:{userId:e,deviceId:t},clientType:d,clientSubType:Gt.clientId,msgType:"cc.deepLink",msgContextId:n.workflow,msgBody:Object.assign({},n),autoContext:{timestamp:(new Date).getTime(),ttl:"medium"},apiVersion:1}]}))(Gt.userContext.userId,un.currentDevice.deviceId,e);return cn.printLog(`Command: ${JSON.stringify(n)}`),Dn(t,n),tn.onExecuteWorkflow(e.workflow),{status:!0}}),connect:e=>new Promise(t=>{return s=function*(){if(cn.areClientsConnected())try{const e=yield un.checkWAMHealthStatus();return void t(e)}catch(e){cn.printLog(`WAM health call is failing in connect, health status call is ${e}`)}cn.initCCDConnection(e).then(e=>{sn.status=e?A.status.success:A.status.failure,sn.totalTimeTaken=(new Date).getTime()-sn.startTime,sn.sendEvent(),t(e)})},new((n=void 0)||(n=Promise))(function(e,t){function r(e){try{i(s.next(e))}catch(e){t(e)}}function o(e){try{i(s.throw(e))}catch(e){t(e)}}function i(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n(function(e){e(s)})).then(r,o)}i((s=s.apply(void 0,[])).next())});var n,s}),addListenerForClientMsg:e=>{Gt.addCallbacks({onMessageCallback:e})},addListenerForClientState:e=>{Gt.addCallbacks({onClientStateCallback:e})},addCallbacksForAnalytics:e=>{Gt.addCallbacks({analyticsCallback:e})},getProductInfo:(e,t)=>Sn(Cn(),e,t),getProductsList:()=>Cn(),getInstalledProduct:e=>{let t;if(e&&cn.areClientsConnected()){const n=Cn();t=n.installed.filter(t=>t.sapcode&&t.sapcode.toUpperCase()===e.toUpperCase())[0],t||(t=n.available_updates.filter(t=>t.sapcode&&t.sapcode.toUpperCase()===e.toUpperCase())[0])}return t},launchProduct:(e,t,n,s)=>{const r=Bn.getInstalledProduct(e);return r?Bn.sendCommand({sapCode:r.sapcode,version:r.version,commandPayload:{command:"launch"},ingestContext:{campaign_id:t,variation_id:n,context_com_name:s}}):Promise.reject({status:!1})},isCCDAppsPanelEnabled:()=>null===yn||"false"===yn,reset:()=>{Tn(),hn=null},disconnect:()=>{un.disconnect()},setAnalyticsPreference:e=>{Gt.sendAnalytics=void 0===e||e}};var Fn={__proto__:null,getUpdateDescription:({sapCode:e,version:t,env:n,platform:s,xAdobeAppId:r,locale:o})=>xn.getUpdateDecription({sapCode:e,version:t,env:n,platform:s,xAdobeAppId:r,locale:o}),processMessage:e=>(e=>{if(cn.printLog(e),hn&&(hn[f]=[]),e.msgBody){const t=e.msgBody.status;switch(t.status){case l.appsPanelInstallAvailabilityStatus:return void(yn=t.appsPanelHidden);case l.ccdAppsState.loading:case l.ccdAppsState.appRefreshedStarted:return void(gn=t.status);case l.ccdAppsState.loadingFailed:case l.ccdAppsState.loaded:return(e=>{if(e&&e.command===m.fetchAppsListFromCCD&&e.status===l.ccdAppsState.loaded){const t=JSON.parse(e.listingDetails);if(t&&(hn=t,Gt.ccdVersion=hn.clientVersion,e.confirmationDetails&&e.confirmationDetails.confirmationSAPCode&&e.confirmationDetails.confirmationVersion)){const t=Sn(hn,e.confirmationDetails.confirmationSAPCode,e.confirmationDetails.confirmationVersion);t.confirmationDetails=e.confirmationDetails,t.status=l.needConfirmation}}else if(e&&e.status===l.ccdAppsState.loadingFailed){hn=null;const e=cn.appendSourceInDesc(`CreativeCloudDesktop failed to respond loaded status. Apps state:${l.ccdAppsState.loadingFailed}`);tn.sendAnalytics({status:"false",errorDesc:e}),tn.sendAnalytics({eventName:I,status:"false",errorType:"error",errorDesc:e}),cn.printLog(e)}gn=e.status})(t),hn;case l.closeConfirmation:if(t.confirmationDetails&&t.confirmationDetails.confirmationID){const e=Sn(hn,null,null,t.confirmationDetails.confirmationID);e&&(e.status=null),Gt.callbacks.onCloseConfirmationCallback&&Gt.callbacks.onCloseConfirmationCallback(t.confirmationDetails.confirmationID)}return}const n=e.msgBody.sapCode,s=e.msgBody.version,r=Sn(hn,n,s);if(r){if(t.command===m.installModule||t.command===m.uninstallModule)return((e,t,n)=>{const s=e.module_list.filter(e=>e.id===n);if(0==s.length)return;const r=s[0],o=t?Object.keys(t):[];for(let e=0;e<o.length;e++){let n=o[e];r[n]=t[n]}})(r,t,e.msgBody.moduleId),hn;switch(r.showRetryBtn=!1,r.action=t.command,r.status=t.status,(e=>{const t=`${e.sapcode}_${e.version}`,n="start",s=s=>{let r;switch(s){case n:case"end":r=pn[t];break;case l.cancelling.toLowerCase():r=e.totalProgressPercent||l.waiting}tn.sendAnalytics({eventName:F,sapcode:e.sapcode,version:e.version,commandName:e.action,commandStage:s,eventValue:r})};if(e){if(e.totalProgressPercent&&e.status&&e.status===l.inprogress){const r=parseInt(e.totalProgressPercent);if(r>=0&&r<=20){if("0"===pn[t])return;pn[t]="0",s(n)}else if(r>=25&&r<=40){if("25"===pn[t])return;pn[t]="25",s(n)}else if(r>=50&&r<=65){if("50"===pn[t])return;pn[t]="50",s(n)}else if(r>=75&&r<=90){if("75"===pn[t])return;pn[t]="75",s(n)}}if(e.status&&e.status===l.completed){if("100"===pn[t])return;pn[t]="100",s("end")}e.status&&e.status===l.cancelling&&s(l.cancelling.toLowerCase())}})(r),t.status){case l.waiting:r.cancelable=t.cancelable;break;case l.inprogress:if(r.totalProgressPercent=t.totalProgressPercent,r.totalProgressPercent||(r.totalProgressPercent=t.total_progress_percent),r.cancelable=t.cancelable,t.modules)try{r.modules=JSON.parse(t.modules)}catch(e){cn.printLog("Error in parsing modules data")}break;case l.needConfirmation:if(!t.confirmationDetails)return;r.confirmationDetails=t.confirmationDetails;break;case l.failed:t.errorDetails&&t.errorDetails.errorCode&&(r.showRetryBtn=!0,r.error_details||(r.error_details={}),r.error_details.error_code=t.errorDetails.errorCode);break;case l.completed:r.stateCategory===h&&t.command===m.startTrial&&("True"===t.trialDetails.isProductInTrial?(r.entitlement_info={status:"TRIAL_ACTIVE",trialDaysRemaining:t.trialDetails.trialDaysRemaining},r.launchable="true"):"True"===t.trialDetails.isTrialExpired&&(r.entitlement_info={status:"TRIAL_EXPIRED"}))}}else if(n&&s&&t.status&&t.status===l.appUnknown)tn.sendAnalytics({eventName:M,sapcode:n,version:s,commandName:"install",commandStage:"app-unknown"}),((e,t,n)=>{fn=fn||[],fn.push({sapcode:e,version:t,status:n,stateCategory:"appUnkown"})})(n,s,t.status);else if(t.status===l.needConfirmation){if(!t.confirmationDetails)return;hn[f]=[{sapcode:f,version:f,status:t.status,stateCategory:f,confirmationDetails:t.confirmationDetails}]}return hn}})(e),isCCDPresent:In,launchCCD:({verifyCCDPresence:e,env:t,aamUrl:n,paramPrefix:s,failureCallback:r})=>{const o=t||Gt.env;if(!o||!U[o])return void(r&&r("env is not set"));const i=()=>{Jt.getFFCPassphrase(o).then(e=>{if(!e&&r)return void r("passphrase_not_available");let t=`aam://passPhrase=${e}?actionList=CC-UI`;if(n){let r="?";nn.aamPluginSupportsAmpersand()&&n.indexOf("?")>=0&&(r="&"),s&&(r=s),t=`${n.replace(/\/$/,"")}${r}passPhrase=${e}${r}actionList=CC-UI`}window.open(t,"_parent")})};e?nn.checkForCCD({env:t}).then(e=>{e?i():r&&r("CCD is not present")}):i()},executeWorkflowViaCCDAAMURI:(e,t,n)=>{if(!t)return;const s=e||Gt.env;s&&U[s]?nn.checkForCCD({env:e}).then(e=>{e?Jt.getFFCPassphrase(s).then(e=>{if(!e&&n)return void n("passphrase_not_available");let s="aam://ccd";const r=Jt.encodeDecodeHandler().encode(t),o=r?Object.keys(r):[];let i="?";for(let e=0;e<o.length;e++){let t=o[e];i=0===e?"?":"&",s=`${s}${i}${t}=${r[t]}`}s=`${s}${i}passPhrase=${e}`,window.open(s,"_parent")}):n&&n("CCD is not present")}):n&&n("env is not set")},Bifrost:Bn},{Bifrost:Mn}=Fn,Ln=Mn;return window.bifrost=Ln,Ln});
